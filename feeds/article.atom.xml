<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom"><title>Doctrina</title><link href="http://doctrina.org/" rel="alternate"></link><link href="http://doctrina.org/feeds/article.atom.xml" rel="self"></link><id>http://doctrina.org/</id><updated>2015-05-11T00:00:00-07:00</updated><entry><title>Maximum Height Of A Red-Black Tree</title><link href="http://doctrina.org/maximum-height-of-red-black-tree.html" rel="alternate"></link><updated>2015-05-11T00:00:00-07:00</updated><author><name>Barry Steyn</name></author><id>tag:doctrina.org,2015-05-11:maximum-height-of-red-black-tree.html</id><summary type="html">&lt;h1 id="introduction"&gt;Introduction&lt;a href="#introduction" title="Permanent link" class="headerlink"&gt;&lt;/a&gt;&lt;/h1&gt;
&lt;p&gt;My friend and colleague, &lt;a href="http://dome.hobbits.grus.uberspace.de/"&gt;Dominik Messinger&lt;/a&gt;&lt;sup class="print"&gt;L1&lt;/sup&gt; was fortunate to learn about abstract data structures in high school&lt;sup id="sf-maximum-height-of-red-black-tree-1-back"&gt;&lt;a href="#sf-maximum-height-of-red-black-tree-1" title="He is German, so I think this is a nod to the excellent school system in Germany." class="simple-footnote"&gt;1&lt;/a&gt;&lt;/sup&gt;. After chatting to him one day, the topic of red-black trees came up. He studied &lt;a href="http://en.wikipedia.org/wiki/AVL_tree"&gt;AVL trees&lt;/a&gt;&lt;sup class="print"&gt;L2&lt;/sup&gt; in depth at high school, but did not do the same for red-black trees. After this chat, I realized I had not formalized this topic in my mind either. So I decided to choose one topic and write about...&lt;/p&gt;
&lt;p&gt;So here is an analysis of the maximum height of a red-black trees.&lt;/p&gt;
&lt;h1 id="background-knowledge"&gt;Background Knowledge&lt;a href="#background-knowledge" title="Permanent link" class="headerlink"&gt;&lt;/a&gt;&lt;/h1&gt;
&lt;h2 id="tree-level"&gt;Tree Level&lt;a href="#tree-level" title="Permanent link" class="headerlink"&gt;&lt;/a&gt;&lt;/h2&gt;
&lt;p&gt;A node's level is the number of parent node ancestors the node has. Level is zero based (the root is at level 0 since it has no ancestors).&lt;/p&gt;
&lt;p&gt;&lt;img src="images/binary-tree-level.png"&gt;&lt;/p&gt;
&lt;p&gt;The number of nodes in a path from the root node to a node at level &lt;span class="math"&gt;\(k\)&lt;/span&gt; is &lt;span class="math"&gt;\(k+1\)&lt;/span&gt;. For example:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;At level 0&lt;/strong&gt;: There is 1 node in the path from root to level 0 (the root node).&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;At level 1&lt;/strong&gt;: There are two nodes in a path from root to level 1.&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;At level &lt;span class="math"&gt;\(k\)&lt;/span&gt;&lt;/strong&gt;: There are &lt;span class="math"&gt;\(k+1\)&lt;/span&gt; nodes in a path from root to level &lt;span class="math"&gt;\(k\)&lt;/span&gt;.&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id="full-and-complete-binary-tree"&gt;Full And Complete Binary Tree&lt;a href="#full-and-complete-binary-tree" title="Permanent link" class="headerlink"&gt;&lt;/a&gt;&lt;/h2&gt;
&lt;p&gt;A tree that is both &lt;em&gt;full and complete&lt;/em&gt;&lt;sup id="sf-maximum-height-of-red-black-tree-2-back"&gt;&lt;a href="#sf-maximum-height-of-red-black-tree-2" title="Full and complete binary trees are sometimes called perfect binary trees." class="simple-footnote"&gt;2&lt;/a&gt;&lt;/sup&gt; has the following properties:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;All non-leaf nodes have two children.&lt;/li&gt;
&lt;li&gt;All leaf nodes are at the same level.&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;&lt;img src="images/full-complete-binary-tree.png"&gt;&lt;/p&gt;
&lt;p&gt;A full and complete binary tree with &lt;span class="math"&gt;\(n\)&lt;/span&gt; nodes and &lt;span class="math"&gt;\(k\)&lt;/span&gt; levels has the following relationship:
&lt;/p&gt;
&lt;div class="math"&gt;\begin{equation*}
n = 2^{k+1}-1
\end{equation*}&lt;/div&gt;
&lt;h1 id="red-black-tree"&gt;Red-Black Tree&lt;a href="#red-black-tree" title="Permanent link" class="headerlink"&gt;&lt;/a&gt;&lt;/h1&gt;
&lt;h2 id="red-black-tree-invariants"&gt;Red-Black Tree Invariants&lt;a href="#red-black-tree-invariants" title="Permanent link" class="headerlink"&gt;&lt;/a&gt;&lt;/h2&gt;
&lt;p&gt;A red-black tree is a &lt;a href="http://en.wikipedia.org/wiki/Binary_search_tree"&gt;binary search tree&lt;/a&gt;&lt;sup class="print"&gt;L3&lt;/sup&gt; that is constrained by the following 4 invariants:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;Each node is either red or black.&lt;/li&gt;
&lt;li&gt;The root node is black.&lt;/li&gt;
&lt;li&gt;Every red node must either have zero or two black chilren.&lt;/li&gt;
&lt;li&gt;Every root-null path must have the same number of black nodes.&lt;/li&gt;
&lt;/ol&gt;
&lt;h3 id="the-maximum-height-of-a-red-black-tree"&gt;The Maximum Height Of A Red-Black Tree&lt;a href="#the-maximum-height-of-a-red-black-tree" title="Permanent link" class="headerlink"&gt;&lt;/a&gt;&lt;/h3&gt;
&lt;p&gt;The maximum height of a red-black tree is the root-null path that contains the most number of nodes. Ironically, an examiniation of the shortest root-null path is needed to calculate the maximum height.&lt;/p&gt;
&lt;h4 id="length-of-the-shortest-root-null-path"&gt;Length Of The Shortest Root-Null Path&lt;a href="#length-of-the-shortest-root-null-path" title="Permanent link" class="headerlink"&gt;&lt;/a&gt;&lt;/h4&gt;
&lt;p&gt;By invariant 4, the &lt;em&gt;maximum number of black nodes&lt;/em&gt; in any root-null path is restricted by the number of nodes in the &lt;em&gt;shortest&lt;/em&gt; root-null path. Assume the shortest root-null path is at level &lt;span class="math"&gt;\(k\)&lt;/span&gt;:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;There are &lt;span class="math"&gt;\(k+1\)&lt;/span&gt; nodes in the root-null path at level &lt;span class="math"&gt;\(k\)&lt;/span&gt;.&lt;/li&gt;
&lt;li&gt;There is a &lt;em&gt;full&lt;/em&gt; and &lt;em&gt;complete&lt;/em&gt; binary subtree with &lt;span class="math"&gt;\(k\)&lt;/span&gt; levels.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;For example, if the shortest root-null path is at level 2, the full and complete binary subtree would look like the image below:&lt;/p&gt;
&lt;p&gt;&lt;img src="images/full-complete-binary-subtree.png"&gt;&lt;/p&gt;
&lt;p&gt;Suppose the full and complete binary subtree has &lt;span class="math"&gt;\(n\)&lt;/span&gt; nodes, then using the fact that &lt;span class="math"&gt;\(n=2^{k+1}-1\)&lt;/span&gt;, the number of nodes in the root-null path (i.e. &lt;span class="math"&gt;\(k+1\)&lt;/span&gt;) is logarithmic in &lt;span class="math"&gt;\(n\)&lt;/span&gt;:&lt;/p&gt;
&lt;div class="math"&gt;\begin{array}{ccc}
n &amp;amp; = &amp;amp; 2^{k+1}-1 \\
k+1 &amp;amp; = &amp;amp; \log_2(n+1)
\end{array}&lt;/div&gt;
&lt;p&gt;&lt;em&gt;Due to invariant 4&lt;/em&gt;, the maximum number of &lt;strong&gt;black nodes&lt;/strong&gt; in any root-null path is &lt;span class="math"&gt;\(\log_2(n+1)\)&lt;/span&gt;&lt;/p&gt;
&lt;h4 id="length-of-the-longest-root-null-path"&gt;Length Of The Longest Root-Null Path&lt;a href="#length-of-the-longest-root-null-path" title="Permanent link" class="headerlink"&gt;&lt;/a&gt;&lt;/h4&gt;
&lt;p&gt;The longest root-null path will have &lt;span class="math"&gt;\(\log_2(n+1)\)&lt;/span&gt; black nodes (the maximum that it can have due to invariant 4). The question now becomes: How many red nodes can be present? By invariant 3, a red node must have black node children. This restricts the maximum number of red nodes to being placed between the black nodes:&lt;/p&gt;
&lt;p&gt;&lt;img src="images/red-black-in-between.png"&gt;&lt;/p&gt;
&lt;p&gt;The maximum number of red nodes in a root-null path is therefore constrained by the maximum number of black nodes, which is &lt;span class="math"&gt;\(\log_2(n+1)\)&lt;/span&gt;. So the length of the longest root-null path is:&lt;/p&gt;
&lt;div class="math"&gt;\begin{array}{lcl}
\text{Maximum height} &amp;amp;=&amp;amp; \text{max black nodes} + \text{max red nodes} \\
                      &amp;amp;=&amp;amp; \log_2(n+1) + \log_2(n+1) \\
                      &amp;amp;=&amp;amp; 2\cdot\log_2(n+1)
\end{array}&lt;/div&gt;
&lt;p&gt;This proves that the height of a red-black tree is &lt;span class="math"&gt;\(O\left(\log n\right)\)&lt;/span&gt; where &lt;span class="math"&gt;\(n\)&lt;/span&gt; is the total number of nodes. It is also worth noting that the constant factor in the big-O notation is &lt;span class="math"&gt;\(2\)&lt;/span&gt;, which is very low.&lt;/p&gt;
&lt;h2 id="searching-is-logarithmic"&gt;Searching Is Logarithmic&lt;a href="#searching-is-logarithmic" title="Permanent link" class="headerlink"&gt;&lt;/a&gt;&lt;/h2&gt;
&lt;p&gt;In a binary search tree, the time complexity of a search operation is governed by the maximum height of the tree. This means that search in a red-black tree is logarithmic time complexity.&lt;/p&gt;
&lt;h1 id="conclusion"&gt;Conclusion&lt;a href="#conclusion" title="Permanent link" class="headerlink"&gt;&lt;/a&gt;&lt;/h1&gt;
&lt;p&gt;A red-black tree is probably the most used balanced binary search tree algorithm. It is a little bit more work to show that &lt;em&gt;update&lt;/em&gt;, &lt;em&gt;delete&lt;/em&gt; and &lt;em&gt;insert&lt;/em&gt; is also logarithmic, but any proof would rely upon the fact the maximum height is logarithmic.&lt;/p&gt;
&lt;script type="text/javascript"&gt;if (!document.getElementById('mathjaxscript_pelican_#%@#$@#')) {
    var align = "center",
        indent = "0em",
        linebreak = "true";

    if (true) {
        align = (screen.width &lt; 768) ? "left" : align;
        indent = (screen.width &lt; 768) ? "0em" : indent;
        linebreak = (screen.width &lt; 768) ? 'true' : linebreak;
    }
    
    var mathjaxscript = document.createElement('script');
    mathjaxscript.id = 'mathjaxscript_pelican_#%@#$@#';
    mathjaxscript.type = 'text/javascript';
    mathjaxscript.src = '//cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML';
    mathjaxscript[(window.opera ? "innerHTML" : "text")] =
        "MathJax.Hub.Config({" +
        "    config: ['MMLorHTML.js']," +
        "    TeX: { extensions: ['AMSmath.js','AMSsymbols.js','noErrors.js','noUndefined.js'], equationNumbers: { autoNumber: 'AMS' } }," +
        "    jax: ['input/TeX','input/MathML','output/HTML-CSS']," +
        "    extensions: ['tex2jax.js','mml2jax.js','MathMenu.js','MathZoom.js']," +
        "    displayAlign: '"+ align +"'," +
        "    displayIndent: '"+ indent +"'," +
        "    showMathMenu: true," +
        "    tex2jax: { " +
        "        inlineMath: [ ['\\\\(','\\\\)'] ], " +
        "        displayMath: [ ['$$','$$'] ]," +
        "        processEscapes: true," +
        "        preview: '[math]'," +
        "    }, " +
        "    'HTML-CSS': { " +
        "        styles: { '.MathJax_Display, .MathJax .mo, .MathJax .mi, .MathJax .mn': {color: 'inherit ! important'} }," +
        "        linebreaks: { automatic: "+ linebreak +", width: '90% container' }," +
        "    }, " +
        "}); " +
        "if ('default' !== 'default') {" +
            "MathJax.Hub.Register.StartupHook('HTML-CSS Jax Ready',function () {" +
                "var VARIANT = MathJax.OutputJax['HTML-CSS'].FONTDATA.VARIANT;" +
                "VARIANT['normal'].fonts.unshift('MathJax_default');" +
                "VARIANT['bold'].fonts.unshift('MathJax_default-bold');" +
                "VARIANT['italic'].fonts.unshift('MathJax_default-italic');" +
                "VARIANT['-tex-mathit'].fonts.unshift('MathJax_default-italic');" +
            "});" +
            "MathJax.Hub.Register.StartupHook('SVG Jax Ready',function () {" +
                "var VARIANT = MathJax.OutputJax.SVG.FONTDATA.VARIANT;" +
                "VARIANT['normal'].fonts.unshift('MathJax_default');" +
                "VARIANT['bold'].fonts.unshift('MathJax_default-bold');" +
                "VARIANT['italic'].fonts.unshift('MathJax_default-italic');" +
                "VARIANT['-tex-mathit'].fonts.unshift('MathJax_default-italic');" +
            "});" +
        "}";
    (document.body || document.getElementsByTagName('head')[0]).appendChild(mathjaxscript);
}
&lt;/script&gt;&lt;h2 class="print"&gt;Links&lt;/h2&gt;&lt;div style="margin-left: 2.0em;" class="print"&gt;&lt;ol class="print-links"&gt;&lt;li&gt;http://dome.hobbits.grus.uberspace.de/&lt;/li&gt;&lt;li&gt;http://en.wikipedia.org/wiki/AVL_tree&lt;/li&gt;&lt;li&gt;http://en.wikipedia.org/wiki/Binary_search_tree&lt;/li&gt;&lt;/ol&gt;&lt;/div&gt;&lt;ol class="simple-footnotes"&gt;&lt;li id="sf-maximum-height-of-red-black-tree-1"&gt;He is German, so I think this is a nod to the excellent school system in Germany. &lt;a href="#sf-maximum-height-of-red-black-tree-1-back" class="simple-footnote-back"&gt;↩&lt;/a&gt;&lt;/li&gt;&lt;li id="sf-maximum-height-of-red-black-tree-2"&gt;Full and complete binary trees are sometimes called &lt;em&gt;perfect binary trees&lt;/em&gt;. &lt;a href="#sf-maximum-height-of-red-black-tree-2-back" class="simple-footnote-back"&gt;↩&lt;/a&gt;&lt;/li&gt;&lt;/ol&gt;</summary><category term="datastructures"></category><category term="red-black tree"></category></entry><entry><title>Do Not Go Gentle Into That Good Night</title><link href="http://doctrina.org/do-not-go-gentle-into-that-good-night.html" rel="alternate"></link><updated>2015-04-02T00:00:00-07:00</updated><author><name>Barry Steyn</name></author><id>tag:doctrina.org,2015-04-02:do-not-go-gentle-into-that-good-night.html</id><summary type="html">&lt;h1 id="do-not-go-gentle-into-that-good-night"&gt;Do Not Go Gentle Into That Good Night&lt;a href="#do-not-go-gentle-into-that-good-night" title="Permanent link" class="headerlink"&gt;&lt;/a&gt;&lt;/h1&gt;
&lt;p&gt;&lt;small&gt;By &lt;a href="http://en.wikipedia.org/wiki/Dylan_Thomas"&gt;Dylan Thomas&lt;/a&gt;&lt;sup class="print"&gt;L1&lt;/sup&gt;&lt;/small&gt;&lt;/p&gt;
&lt;p&gt;Do not go gentle into that good night,&lt;br&gt;
Old age should burn and rave at close of day;&lt;br&gt;
Rage, rage against the dying of the light.&lt;br&gt;&lt;/p&gt;
&lt;p&gt;Though wise men at their end know dark is right,&lt;br&gt;
Because their words had forked no lightning they&lt;br&gt;
Do not go gentle into that good night.&lt;br&gt;&lt;/p&gt;
&lt;p&gt;Good men, the last wave by, crying how bright&lt;br&gt;
Their frail deeds might have danced in a green bay,&lt;br&gt;
Rage, rage against the dying of the light.&lt;br&gt;&lt;/p&gt;
&lt;p&gt;Wild men who caught and sang the sun in flight,&lt;br&gt;
And learn, too late, they grieved it on its way,&lt;br&gt;
Do not go gentle into that good night.&lt;br&gt;&lt;/p&gt;
&lt;p&gt;Grave men, near death, who see with blinding sight&lt;br&gt;
Blind eyes could blaze like meteors and be gay,&lt;br&gt;
Rage, rage against the dying of the light.&lt;br&gt;&lt;/p&gt;
&lt;p&gt;And you, my father, there on the sad height,&lt;br&gt;
Curse, bless, me now with your fierce tears, I pray.&lt;br&gt;
Do not go gentle into that good night.&lt;br&gt;
Rage, rage against the dying of the light.&lt;br&gt;&lt;/p&gt;
&lt;p&gt;&lt;/p&gt;&lt;div class="videobox"&gt;
                &lt;iframe src="https://www.youtube.com/embed/2DLqN1RvfUc" height="390" mozallowfullscreen="" width="640" frameborder="0" allowfullscreen="" webkitallowfullscreen=""&gt;
                &lt;/iframe&gt;
            &lt;/div&gt;&lt;p&gt;&lt;/p&gt;&lt;h2 class="print"&gt;Links&lt;/h2&gt;&lt;div style="margin-left: 2.0em;" class="print"&gt;&lt;ol class="print-links"&gt;&lt;li&gt;http://en.wikipedia.org/wiki/Dylan_Thomas&lt;/li&gt;&lt;/ol&gt;&lt;/div&gt;</summary><category term="art"></category></entry><entry><title>The Starting Node Of A Cycle In A Linked List</title><link href="http://doctrina.org/Starting_Node_Of_A_Cycle_In_A_Linked_List.html" rel="alternate"></link><updated>2015-02-18T00:00:00-08:00</updated><author><name>Barry Steyn</name></author><id>tag:doctrina.org,2015-02-18:Starting_Node_Of_A_Cycle_In_A_Linked_List.html</id><summary type="html">&lt;h1 id="introduction"&gt;Introduction&lt;a href="#introduction" title="Permanent link" class="headerlink"&gt;&lt;/a&gt;&lt;/h1&gt;
&lt;p&gt;Given a &lt;a href="http://en.wikipedia.org/wiki/Linked_list#Singly_linked_list"&gt;singly linked list&lt;/a&gt;&lt;sup class="print"&gt;L1&lt;/sup&gt; that has a cycle, how can one determine the first node in the cycle?&lt;/p&gt;
&lt;p&gt;&lt;img src="http://doctrina.org/images/ll-cycle-problem.png"&gt;&lt;/p&gt;
&lt;p&gt;Using the image above as an example, the aim would be to find the orange node.&lt;/p&gt;
&lt;h1 id="algorithm"&gt;Algorithm&lt;a href="#algorithm" title="Permanent link" class="headerlink"&gt;&lt;/a&gt;&lt;/h1&gt;
&lt;p&gt;&lt;img src="http://doctrina.org/images/ll-cycle-intersection.png"&gt;
Use two iterators, but make one move at twice the speed of the other. Starting from the head (first) node of the list, these iterators will meet at the red colored node. Now set one iterator back to the head node and leave the other at the red node. Moving both iterators at normal speed where they meet for the second time will be the orange node.&lt;/p&gt;
&lt;p&gt;Go through this algorithm yourself with the above image, and it can easily be that the algorithm works for this example. Ever wondered why it worked? I did, but I never really thought of it until I was chatting to my colleague &lt;a href="http://www.jooyandeh.com/"&gt;Reza Jooyandeh&lt;/a&gt;&lt;sup class="print"&gt;L2&lt;/sup&gt;. Reza immediately saw a nice way to prove this algorithm, I am just formalizing it here.&lt;/p&gt;
&lt;h2 id="history"&gt;History&lt;a href="#history" title="Permanent link" class="headerlink"&gt;&lt;/a&gt;&lt;/h2&gt;
&lt;p&gt;This algorithm actually has a formal name: It is called &lt;a href="http://en.wikipedia.org/wiki/Cycle_detection#Tortoise_and_hare"&gt;Floyd's cycle-finding algorithm&lt;/a&gt;&lt;sup class="print"&gt;L3&lt;/sup&gt; and can be used to find cycles in a graph (a linked-list is also a graph) without using extra space in linear time. It is named after &lt;a href="http://en.wikipedia.org/wiki/Robert_W._Floyd"&gt;Robert W. Floyd&lt;/a&gt;&lt;sup class="print"&gt;L4&lt;/sup&gt;.&lt;/p&gt;
&lt;h1 id="proof-of-the-algorithm"&gt;Proof Of The Algorithm&lt;a href="#proof-of-the-algorithm" title="Permanent link" class="headerlink"&gt;&lt;/a&gt;&lt;/h1&gt;
&lt;p&gt;&lt;img src="http://doctrina.org/images/ll-cycle-definition.png"&gt;&lt;/p&gt;
&lt;p&gt;Assume the following (refer to the above image):&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;The node that starts the cycle is colored orange.&lt;/li&gt;
&lt;li&gt;There are &lt;span class="math"&gt;\(X\)&lt;/span&gt; number of nodes up to and including the orange node.&lt;/li&gt;
&lt;li&gt;The cycle contains &lt;span class="math"&gt;\(Y\)&lt;/span&gt; number of nodes where &lt;span class="math"&gt;\(Y \geq 2\)&lt;/span&gt; (since by definition, a cycle must contain at least two nodes).&lt;/li&gt;
&lt;li&gt;The two iterators first meet after &lt;span class="math"&gt;\(Z\)&lt;/span&gt; nodes from the start of the cycle (these nodes are colored red in the above image).&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id="aim-of-the-proof"&gt;Aim Of The Proof&lt;a href="#aim-of-the-proof" title="Permanent link" class="headerlink"&gt;&lt;/a&gt;&lt;/h2&gt;
&lt;p&gt;The aim is to prove that the starting node of the cycle will be reached after advancing &lt;span class="math"&gt;\(X\)&lt;/span&gt; number of nodes from where the iterators first meet (&lt;span class="math"&gt;\(Z\)&lt;/span&gt; nodes into the cycle). Why does this suffice? Because we assume that there are &lt;span class="math"&gt;\(X\)&lt;/span&gt; number of nodes leading up to the start of the cycle, so advancing &lt;span class="math"&gt;\(X\)&lt;/span&gt; number of nodes inside the cycle to get to the start implies that the two iterators will meet at the beginning of the cycle.&lt;/p&gt;
&lt;h2 id="proof"&gt;Proof&lt;a href="#proof" title="Permanent link" class="headerlink"&gt;&lt;/a&gt;&lt;/h2&gt;
&lt;p&gt;The proof is done in two parts. It is proved that:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;The fast iterator cannot "jump" over the slow iterator in the cycle. &lt;/li&gt;
&lt;li&gt;Advancing by &lt;span class="math"&gt;\(X\)&lt;/span&gt; nodes from &lt;span class="math"&gt;\(Z\)&lt;/span&gt; nodes into the cycle will yield the beginning of the cycle.&lt;/li&gt;
&lt;/ol&gt;
&lt;h3 id="the-fast-iterator-cannot-jump-over-the-slow-iterator-in-the-cycle"&gt;The fast iterator cannot "jump" over the slow iterator in the cycle&lt;a href="#the-fast-iterator-cannot-jump-over-the-slow-iterator-in-the-cycle" title="Permanent link" class="headerlink"&gt;&lt;/a&gt;&lt;/h3&gt;
&lt;p&gt;This proved by contradiction. Assume the fast iterator will always jump over the slow iterator. Then if the slow iterator ends at position &lt;span class="math"&gt;\((x+1)\)&lt;/span&gt;, the fast iterator will end at &lt;span class="math"&gt;\((x+2)\)&lt;/span&gt;. But this can only happen if both iterators started at position &lt;span class="math"&gt;\(x\)&lt;/span&gt;, which is a contracdiction.&lt;/p&gt;
&lt;p&gt;This has three implications:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;The iterators will &lt;em&gt;always&lt;/em&gt; meet in the cycle.&lt;/li&gt;
&lt;li&gt;The slow iterator cannot complete more than one cycle before the intersection occurs.&lt;/li&gt;
&lt;li&gt;By the above implication, this algorithm is linear in the number of nodes present: &lt;span class="math"&gt;\(O(n)\)&lt;/span&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;The second implication above may need some explaining. The cycle has &lt;span class="math"&gt;\(Y\)&lt;/span&gt; nodes, and while the slow iterator advances over those nodes, the fast iterator will catch up to it. As shown above, the fast iterator cannot jump over the slow iterator and therefore they will meet (I leave this as an exercise to the reader to prove more formally).&lt;/p&gt;
&lt;h3 id="advancing-by-x-nodes-from-z-nodes-into-the-cycle-will-yield-the-beginning-of-the-cycle"&gt;Advancing by &lt;span class="math"&gt;\(X\)&lt;/span&gt; nodes from &lt;span class="math"&gt;\(Z\)&lt;/span&gt; nodes into the cycle will yield the beginning of the cycle.&lt;a href="#advancing-by-x-nodes-from-z-nodes-into-the-cycle-will-yield-the-beginning-of-the-cycle" title="Permanent link" class="headerlink"&gt;&lt;/a&gt;&lt;/h3&gt;
&lt;p&gt;To start the proof, note that the two iterators first meet after &lt;span class="math"&gt;\(Z\)&lt;/span&gt; nodes from the start of the cycle. The iterator that advances at normal speed would have progressed &lt;span class="math"&gt;\(X+Z\)&lt;/span&gt;. The iterator that advances at double speed could potentially have gone round the cycle many times, so it would have progressed &lt;span class="math"&gt;\(X+n\cdot Y+Z\)&lt;/span&gt; nodes, where &lt;span class="math"&gt;\(n \in \mathbb{N}\)&lt;/span&gt;. The proof starts by establishing a relationship between these iterators: The number of nodes progressed by the normal iterator at double speed (i.e. &lt;span class="math"&gt;\(2\cdot (X+Y)\)&lt;/span&gt;) is equal to the number of nodes progressed by the fast iterator (i.e. &lt;span class="math"&gt;\(X+n\cdot Y+Z\)&lt;/span&gt;).&lt;/p&gt;
&lt;div class="math"&gt;\begin{array}{ll}
X+n\cdot Y+Z &amp;amp; = &amp;amp; 2\cdot (X+Z) \text{ where } n \in \mathbb{N} \\
Z+X &amp;amp; = &amp;amp; n\cdot Y \\
Z+X &amp;amp; = &amp;amp; 0\bmod Y \\
\end{array}&lt;/div&gt;
&lt;p&gt;
This proves that advancing by &lt;span class="math"&gt;\(X\)&lt;/span&gt; nodes from &lt;span class="math"&gt;\(Z\)&lt;/span&gt; will get to the start of the cylce.&lt;/p&gt;
&lt;script type="text/javascript"&gt;if (!document.getElementById('mathjaxscript_pelican_#%@#$@#')) {
    var align = "center",
        indent = "0em",
        linebreak = "true";

    if (true) {
        align = (screen.width &lt; 768) ? "left" : align;
        indent = (screen.width &lt; 768) ? "0em" : indent;
        linebreak = (screen.width &lt; 768) ? 'true' : linebreak;
    }
    
    var mathjaxscript = document.createElement('script');
    mathjaxscript.id = 'mathjaxscript_pelican_#%@#$@#';
    mathjaxscript.type = 'text/javascript';
    mathjaxscript.src = '//cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML';
    mathjaxscript[(window.opera ? "innerHTML" : "text")] =
        "MathJax.Hub.Config({" +
        "    config: ['MMLorHTML.js']," +
        "    TeX: { extensions: ['AMSmath.js','AMSsymbols.js','noErrors.js','noUndefined.js'], equationNumbers: { autoNumber: 'AMS' } }," +
        "    jax: ['input/TeX','input/MathML','output/HTML-CSS']," +
        "    extensions: ['tex2jax.js','mml2jax.js','MathMenu.js','MathZoom.js']," +
        "    displayAlign: '"+ align +"'," +
        "    displayIndent: '"+ indent +"'," +
        "    showMathMenu: true," +
        "    tex2jax: { " +
        "        inlineMath: [ ['\\\\(','\\\\)'] ], " +
        "        displayMath: [ ['$$','$$'] ]," +
        "        processEscapes: true," +
        "        preview: '[math]'," +
        "    }, " +
        "    'HTML-CSS': { " +
        "        styles: { '.MathJax_Display, .MathJax .mo, .MathJax .mi, .MathJax .mn': {color: 'inherit ! important'} }," +
        "        linebreaks: { automatic: "+ linebreak +", width: '90% container' }," +
        "    }, " +
        "}); " +
        "if ('default' !== 'default') {" +
            "MathJax.Hub.Register.StartupHook('HTML-CSS Jax Ready',function () {" +
                "var VARIANT = MathJax.OutputJax['HTML-CSS'].FONTDATA.VARIANT;" +
                "VARIANT['normal'].fonts.unshift('MathJax_default');" +
                "VARIANT['bold'].fonts.unshift('MathJax_default-bold');" +
                "VARIANT['italic'].fonts.unshift('MathJax_default-italic');" +
                "VARIANT['-tex-mathit'].fonts.unshift('MathJax_default-italic');" +
            "});" +
            "MathJax.Hub.Register.StartupHook('SVG Jax Ready',function () {" +
                "var VARIANT = MathJax.OutputJax.SVG.FONTDATA.VARIANT;" +
                "VARIANT['normal'].fonts.unshift('MathJax_default');" +
                "VARIANT['bold'].fonts.unshift('MathJax_default-bold');" +
                "VARIANT['italic'].fonts.unshift('MathJax_default-italic');" +
                "VARIANT['-tex-mathit'].fonts.unshift('MathJax_default-italic');" +
            "});" +
        "}";
    (document.body || document.getElementsByTagName('head')[0]).appendChild(mathjaxscript);
}
&lt;/script&gt;&lt;h2 class="print"&gt;Links&lt;/h2&gt;&lt;div style="margin-left: 2.0em;" class="print"&gt;&lt;ol class="print-links"&gt;&lt;li&gt;http://en.wikipedia.org/wiki/Linked_list#Singly_linked_list&lt;/li&gt;&lt;li&gt;http://www.jooyandeh.com/&lt;/li&gt;&lt;li&gt;http://en.wikipedia.org/wiki/Cycle_detection#Tortoise_and_hare&lt;/li&gt;&lt;li&gt;http://en.wikipedia.org/wiki/Robert_W._Floyd&lt;/li&gt;&lt;/ol&gt;&lt;/div&gt;</summary><category term="algorithms"></category><category term="math"></category></entry><entry><title>Merge Sort And Inversions</title><link href="http://doctrina.org/Merge-Sort-And-Inversions.html" rel="alternate"></link><updated>2013-03-16T00:00:00-07:00</updated><author><name>Barry Steyn</name></author><id>tag:doctrina.org,2013-03-16:Merge-Sort-And-Inversions.html</id><summary type="html">&lt;h1 id="merge-sort"&gt;Merge Sort&lt;a href="#merge-sort" title="Permanent link" class="headerlink"&gt;&lt;/a&gt;&lt;/h1&gt;
&lt;p&gt;Merge sort is the classic divide and conquor algorithm, and is used as a canonical example for explaining the topic. It is quite easy to implement (specially in Python) but I wanted to see a C implementation. Google found me some &lt;a href="http://www.stackoverflow.com"&gt;stack overflow&lt;/a&gt;&lt;sup class="print"&gt;L1&lt;/sup&gt; links as well as several blog sites that listed code. And oh my god, the code was terrible. Most code that I have seen is a mixture of &lt;a href="http://en.wikipedia.org/wiki/Quick_sort"&gt;Quick Sort&lt;/a&gt;&lt;sup class="print"&gt;L2&lt;/sup&gt;. And there are several untruths, for instance, that one can implement merge sort in place!&lt;/p&gt;
&lt;p&gt;Merge sort is &lt;span class="math"&gt;\(O(n\cdot log(n))\)&lt;/span&gt;, and in fact, it is proven that for a comparison based sort, one cannot achieve better results. So then why is Quick Sort so popular when it is &lt;span class="math"&gt;\(O(n^2)\)&lt;/span&gt;? It is because Quick Sort has average complexity of &lt;span class="math"&gt;\(O(n\cdot log(n))\)&lt;/span&gt; (one has to choose very unlucky random pivots for it to be &lt;span class="math"&gt;\(O(n^2)\)&lt;/span&gt;) but also, Quick Sort can be accomplished in place. Merge Sort cannot! In fact, merge sort's space complexity is always going to be &lt;span class="math"&gt;\(2\cdot n\)&lt;/span&gt; - there is no getting around this and still guaranteeing &lt;span class="math"&gt;\(O(n\cdot log(n))\)&lt;/span&gt; performance.&lt;/p&gt;
&lt;p&gt;To Summarize:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Merge Sort is &lt;span class="math"&gt;\(O(n\cdot log(n))\)&lt;/span&gt;.&lt;/li&gt;
&lt;li&gt;Merge Sort cannot sort in place.&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id="merge-sort-example-code"&gt;Merge Sort Example Code&lt;a href="#merge-sort-example-code" title="Permanent link" class="headerlink"&gt;&lt;/a&gt;&lt;/h2&gt;
&lt;p&gt;Here is my C implementation of Merge Sort. The merge function is where the extra space is required, and although it is only required temporarily and destroyed once the stack is popped, it still makes the sort require &lt;span class="math"&gt;\(2\cdot n\)&lt;/span&gt; space.&lt;/p&gt;
&lt;script src="https://gist.github.com/barrysteyn/5177637.js?file=mergesort.c"&gt;&lt;/script&gt;

&lt;p&gt;Note the following:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;In line 2, a &lt;code&gt;temp&lt;/code&gt; array is declared that is the size of the two merged subarrays combined. It is this array that makes Merge Sort not an &lt;em&gt;in place&lt;/em&gt; sort.&lt;/li&gt;
&lt;li&gt;In line 13, the &lt;code&gt;temp&lt;/code&gt; array is copied back into the original array. There is no other way to achieve &lt;span class="math"&gt;\(O(n)\)&lt;/span&gt; complexity for this function unless a temp variable is used.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Why did I mention &lt;span class="math"&gt;\(O(n)\)&lt;/span&gt; in the above line when Merge Sort is &lt;span class="math"&gt;\(O(n\cdot log(n))\)&lt;/span&gt;? It is because I am only referring to the merge function, which must be &lt;span class="math"&gt;\(O(n)\)&lt;/span&gt;. The merge sort algorithm, being a binary divide and conquer, will run that merge function &lt;span class="math"&gt;\(log_2n\)&lt;/span&gt; times, giving Merge Sort worst case complexity of &lt;span class="math"&gt;\(O(n\cdot log(n))\)&lt;/span&gt;.&lt;/p&gt;
&lt;p&gt;It would be used like so:&lt;/p&gt;
&lt;script src="https://gist.github.com/barrysteyn/5177637.js?file=main.c"&gt;&lt;/script&gt;

&lt;h1 id="counting-split-inversions"&gt;Counting Split Inversions&lt;a href="#counting-split-inversions" title="Permanent link" class="headerlink"&gt;&lt;/a&gt;&lt;/h1&gt;
&lt;p&gt;Merge sort leads to interesting applications besides sorting. One of the most interesting is counting the number of split inversions between two arrays. Assuming there are two arrays, the number of split inversions counts the number of swaps one array needs to transform into the other array. A &lt;em&gt;split inversion count&lt;/em&gt; forms a &lt;a href="http://en.wikipedia.org/wiki/Metric_space"&gt;metric space&lt;/a&gt;&lt;sup class="print"&gt;L3&lt;/sup&gt; over the two arrays, and therefore one can accomplish measurements with it. For instance, one can use the inversion count as a metric for a recommender. How? If someone ranks movies from one to five, then that ranking can be compared to other rankings. One can then find similar rankings to note that these people have the same taste and therefore recommend movies that one person likes to the other.&lt;/p&gt;
&lt;h2 id="counting-inversions-brute-force"&gt;Counting Inversions: Brute Force&lt;a href="#counting-inversions-brute-force" title="Permanent link" class="headerlink"&gt;&lt;/a&gt;&lt;/h2&gt;
&lt;p&gt;A brute force algorithm would be to compare each element in both arrays to each other, and determine if they would need to be swapped. This is &lt;span class="math"&gt;\(O(n^2)\)&lt;/span&gt; (quadratic in &lt;span class="math"&gt;\(n\)&lt;/span&gt;). Can we do better?&lt;/p&gt;
&lt;h2 id="counting-inversions-divide-and-conquer"&gt;Counting Inversions: Divide And Conquer&lt;a href="#counting-inversions-divide-and-conquer" title="Permanent link" class="headerlink"&gt;&lt;/a&gt;&lt;/h2&gt;
&lt;p&gt;In fact, we can do much better. The key point to note that is that we can get this information for free during the merge stage of the Merge Sort. &lt;/p&gt;
&lt;p&gt;In the merge stage, two sorted arrays are merged into one sorted array. Lets call these arrays &lt;span class="math"&gt;\(A\)&lt;/span&gt; and &lt;span class="math"&gt;\(B\)&lt;/span&gt;. Then the number of split inversions involving an element &lt;span class="math"&gt;\(y \in B\)&lt;/span&gt; of the second array is &lt;em&gt;precisely the number elements lefts in the first array &lt;span class="math"&gt;\(A\)&lt;/span&gt; when &lt;span class="math"&gt;\(y\)&lt;/span&gt; is copied into the temporary buffer&lt;/em&gt;. Adding up these split inversions during the merge stage will result in the total number of split inversions.&lt;/p&gt;
&lt;script src="https://gist.github.com/barrysteyn/5177637.js?file=merge-sort-with-split-inversion-count.c"&gt;&lt;/script&gt;

&lt;script type="text/javascript"&gt;if (!document.getElementById('mathjaxscript_pelican_#%@#$@#')) {
    var align = "center",
        indent = "0em",
        linebreak = "true";

    if (true) {
        align = (screen.width &lt; 768) ? "left" : align;
        indent = (screen.width &lt; 768) ? "0em" : indent;
        linebreak = (screen.width &lt; 768) ? 'true' : linebreak;
    }
    
    var mathjaxscript = document.createElement('script');
    mathjaxscript.id = 'mathjaxscript_pelican_#%@#$@#';
    mathjaxscript.type = 'text/javascript';
    mathjaxscript.src = '//cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML';
    mathjaxscript[(window.opera ? "innerHTML" : "text")] =
        "MathJax.Hub.Config({" +
        "    config: ['MMLorHTML.js']," +
        "    TeX: { extensions: ['AMSmath.js','AMSsymbols.js','noErrors.js','noUndefined.js'], equationNumbers: { autoNumber: 'AMS' } }," +
        "    jax: ['input/TeX','input/MathML','output/HTML-CSS']," +
        "    extensions: ['tex2jax.js','mml2jax.js','MathMenu.js','MathZoom.js']," +
        "    displayAlign: '"+ align +"'," +
        "    displayIndent: '"+ indent +"'," +
        "    showMathMenu: true," +
        "    tex2jax: { " +
        "        inlineMath: [ ['\\\\(','\\\\)'] ], " +
        "        displayMath: [ ['$$','$$'] ]," +
        "        processEscapes: true," +
        "        preview: '[math]'," +
        "    }, " +
        "    'HTML-CSS': { " +
        "        styles: { '.MathJax_Display, .MathJax .mo, .MathJax .mi, .MathJax .mn': {color: 'inherit ! important'} }," +
        "        linebreaks: { automatic: "+ linebreak +", width: '90% container' }," +
        "    }, " +
        "}); " +
        "if ('default' !== 'default') {" +
            "MathJax.Hub.Register.StartupHook('HTML-CSS Jax Ready',function () {" +
                "var VARIANT = MathJax.OutputJax['HTML-CSS'].FONTDATA.VARIANT;" +
                "VARIANT['normal'].fonts.unshift('MathJax_default');" +
                "VARIANT['bold'].fonts.unshift('MathJax_default-bold');" +
                "VARIANT['italic'].fonts.unshift('MathJax_default-italic');" +
                "VARIANT['-tex-mathit'].fonts.unshift('MathJax_default-italic');" +
            "});" +
            "MathJax.Hub.Register.StartupHook('SVG Jax Ready',function () {" +
                "var VARIANT = MathJax.OutputJax.SVG.FONTDATA.VARIANT;" +
                "VARIANT['normal'].fonts.unshift('MathJax_default');" +
                "VARIANT['bold'].fonts.unshift('MathJax_default-bold');" +
                "VARIANT['italic'].fonts.unshift('MathJax_default-italic');" +
                "VARIANT['-tex-mathit'].fonts.unshift('MathJax_default-italic');" +
            "});" +
        "}";
    (document.body || document.getElementsByTagName('head')[0]).appendChild(mathjaxscript);
}
&lt;/script&gt;&lt;h2 class="print"&gt;Links&lt;/h2&gt;&lt;div style="margin-left: 2.0em;" class="print"&gt;&lt;ol class="print-links"&gt;&lt;li&gt;http://www.stackoverflow.com&lt;/li&gt;&lt;li&gt;http://en.wikipedia.org/wiki/Quick_sort&lt;/li&gt;&lt;li&gt;http://en.wikipedia.org/wiki/Metric_space&lt;/li&gt;&lt;/ol&gt;&lt;/div&gt;</summary><category term="Software"></category><category term="Computer Science"></category><category term="Algorithms"></category></entry><entry><title>JavaScript Lecture: Cryptography In The Browser</title><link href="http://doctrina.org/JavaScript_Lecture:Cryptography_In_The_Browser.html" rel="alternate"></link><updated>2013-03-14T00:00:00-07:00</updated><author><name>Barry Steyn</name></author><id>tag:doctrina.org,2013-03-14:JavaScript_Lecture:Cryptography_In_The_Browser.html</id><summary type="html">&lt;p&gt;I was recently asked to lecture the local Toronto JavaScript meetup about Cryptography in the browser. Here are my lecture slides. Apparently, there is a video of my talk that will be put up. When I get, I will link to it over here.&lt;/p&gt;
&lt;p&gt;Enjoy, and I would grateful for any feedback. Do note that the audience was not hard-core cryptographers.&lt;/p&gt;
&lt;p&gt;&lt;center&gt;&lt;iframe src="http://www.slideshare.net/slideshow/embed_code/17424793" width="476" height="400" frameborder="0" marginwidth="0" marginheight="0" scrolling="no"&gt;&lt;/iframe&gt;&lt;/center&gt;&lt;/p&gt;</summary><category term="JavaScript"></category><category term="Cryptography"></category><category term="Lecture"></category></entry><entry><title>Mathematical Nonsense - Inifinte Sum Series</title><link href="http://doctrina.org/Mathematical_Nonsense_-Inifinite-Sum-Series.html" rel="alternate"></link><updated>2013-03-02T00:00:00-08:00</updated><author><name>Barry Steyn</name></author><id>tag:doctrina.org,2013-03-02:Mathematical_Nonsense_-Inifinite-Sum-Series.html</id><summary type="html">&lt;p&gt;The following fact for infinite series crops up all the time:&lt;/p&gt;
&lt;div class="math"&gt;$$ r\neq 1, 1+r+r^2+r^3+\ldots +r^k = \frac{r^{k+1}-1}{r-1} $$&lt;/div&gt;
&lt;h1 id="proof"&gt;Proof&lt;a class="headerlink" href="#proof" title="Permanent link"&gt;&lt;/a&gt;&lt;/h1&gt;
&lt;p&gt;The proof is by induction:&lt;/p&gt;
&lt;h3 id="base-case-k1"&gt;Base Case: k=1&lt;a class="headerlink" href="#base-case-k1" title="Permanent link"&gt;&lt;/a&gt;&lt;/h3&gt;
&lt;p&gt;For the base case, where k=1, the left hand side of the above sum is &lt;span class="math"&gt;\(1+r\)&lt;/span&gt;, and the right hand side is &lt;span class="math"&gt;\(\frac{r^2-1}{1-r}\)&lt;/span&gt;:&lt;/p&gt;
&lt;div class="math"&gt;\begin{aligned}
 1+r &amp;amp;= (1+r)\cdot \frac{1-r}{1-r} \cr
 &amp;amp;= \frac{(1+r)(1-r)}{1-r} \cr
 &amp;amp;= \frac{r^2-1}{1-r} \cr
\end{aligned}&lt;/div&gt;
&lt;h3 id="inductive-case-kn"&gt;Inductive Case: k=n&lt;a class="headerlink" href="#inductive-case-kn" title="Permanent link"&gt;&lt;/a&gt;&lt;/h3&gt;
&lt;p&gt;Assume the above holds for &lt;span class="math"&gt;\(k=n-1\)&lt;/span&gt;, then &lt;span class="math"&gt;\(1+r+r^2+r^3+\ldots +r^{n-1} = \frac{r^n-1}{r-1}\)&lt;/span&gt;. &lt;/p&gt;
&lt;div class="math"&gt;$$\left( 1+r+r^2+r^3+\ldots +r^{n-1} \right) + r^n $$&lt;/div&gt;
&lt;p&gt;By the inductive argument:&lt;/p&gt;
&lt;div class="math"&gt;\begin{aligned}
 &amp;amp;= \frac{r^n-1}{r-1} + r^n \cr
 &amp;amp;= \frac{r^n\cdot(r-1)+r^n-1}{r-1} \cr
 &amp;amp;= \frac{r^{n+1} - r^n + r^n -1}{r-1} \cr
 &amp;amp;= \frac{r^{n+1} -1}{r-1} \cr
\end{aligned}&lt;/div&gt;
&lt;h1 id="some-useful-facts"&gt;Some useful facts&lt;a class="headerlink" href="#some-useful-facts" title="Permanent link"&gt;&lt;/a&gt;&lt;/h1&gt;
&lt;h3 id="assume-r-1-then-the-sum-is-bounded-by-frac11-r"&gt;Assume r &amp;lt; 1, then the sum is bounded by &lt;span class="math"&gt;\(\frac{1}{1-r}\)&lt;/span&gt;&lt;a class="headerlink" href="#assume-r-1-then-the-sum-is-bounded-by-frac11-r" title="Permanent link"&gt;&lt;/a&gt;&lt;/h3&gt;
&lt;p&gt;If &lt;span class="math"&gt;\(r &amp;lt; 1\)&lt;/span&gt;, then: &lt;span class="math"&gt;\(1+r+r^2+r^3+\ldots +r^k \leq \frac{1}{1-r}\)&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;This is easy to see: if &lt;span class="math"&gt;\(r&amp;lt;1\)&lt;/span&gt;, then &lt;span class="math"&gt;\(1 - r^{k+1} \leq 1\)&lt;/span&gt;, and so &lt;span class="math"&gt;\(\frac{r^{k+1}-1}{r-1} = \frac{1-r^{k+1}}{1-r}\leq \frac{1}{1-r}\)&lt;/span&gt;.&lt;/p&gt;
&lt;p&gt;In this case, the series sum is dominated by the first term (e.g. 1), and is bounded above by something that is independent of k.&lt;/p&gt;
&lt;h3 id="assume-r-1-then-the-sum-is-bounded-by-rkcdot-left1frac1r-1-right"&gt;Assume r &amp;gt; 1, then the sum is bounded by &lt;span class="math"&gt;\(r^k\cdot \left(1+\frac{1}{r-1} \right)\)&lt;/span&gt;&lt;a class="headerlink" href="#assume-r-1-then-the-sum-is-bounded-by-rkcdot-left1frac1r-1-right" title="Permanent link"&gt;&lt;/a&gt;&lt;/h3&gt;
&lt;p&gt;If &lt;span class="math"&gt;\(r &amp;gt; 1\)&lt;/span&gt;, then: &lt;span class="math"&gt;\( 1+r+r^2+r^3+\ldots +r^k \leq r^k\cdot \left(1+\frac{1}{r-1} \right)\)&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;The proof:
&lt;/p&gt;
&lt;div class="math"&gt;\begin{aligned}
 \frac{r^{k+1}-1}{r-1} &amp;amp;\leq \frac{r^{k+1}+1}{r-1}\cr
 &amp;amp;= \frac{r^{k+1}}{r-1} + \frac{1}{r-1} \cr
 &amp;amp;= r^k\cdot \frac{r}{r-1} + \frac{1}{r-1} \cr
 &amp;amp;\leq r^k + \frac{1}{r-1} \cr
 &amp;amp;\leq r^k + \frac{r^k}{r-1} \cr
 &amp;amp;= r^k \cdot \left(1 + \frac{1}{r-1} \right) \cr
\end{aligned}&lt;/div&gt;
&lt;p&gt;In this case, the series sum is dominated by the last term (e.g. &lt;span class="math"&gt;\(r^k\)&lt;/span&gt;), and is bounded above by &lt;span class="math"&gt;\(2\cdot r^k\)&lt;/span&gt;.&lt;/p&gt;
&lt;script type="text/javascript"&gt;if (!document.getElementById('mathjaxscript_pelican_#%@#$@#')) {
    var align = "center",
        indent = "0em",
        linebreak = "true";

    if (true) {
        align = (screen.width &lt; 768) ? "left" : align;
        indent = (screen.width &lt; 768) ? "0em" : indent;
        linebreak = (screen.width &lt; 768) ? 'true' : linebreak;
    }
    
    var mathjaxscript = document.createElement('script');
    mathjaxscript.id = 'mathjaxscript_pelican_#%@#$@#';
    mathjaxscript.type = 'text/javascript';
    mathjaxscript.src = '//cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML';
    mathjaxscript[(window.opera ? "innerHTML" : "text")] =
        "MathJax.Hub.Config({" +
        "    config: ['MMLorHTML.js']," +
        "    TeX: { extensions: ['AMSmath.js','AMSsymbols.js','noErrors.js','noUndefined.js'], equationNumbers: { autoNumber: 'AMS' } }," +
        "    jax: ['input/TeX','input/MathML','output/HTML-CSS']," +
        "    extensions: ['tex2jax.js','mml2jax.js','MathMenu.js','MathZoom.js']," +
        "    displayAlign: '"+ align +"'," +
        "    displayIndent: '"+ indent +"'," +
        "    showMathMenu: true," +
        "    tex2jax: { " +
        "        inlineMath: [ ['\\\\(','\\\\)'] ], " +
        "        displayMath: [ ['$$','$$'] ]," +
        "        processEscapes: true," +
        "        preview: '[math]'," +
        "    }, " +
        "    'HTML-CSS': { " +
        "        styles: { '.MathJax_Display, .MathJax .mo, .MathJax .mi, .MathJax .mn': {color: 'inherit ! important'} }," +
        "        linebreaks: { automatic: "+ linebreak +", width: '90% container' }," +
        "    }, " +
        "}); " +
        "if ('default' !== 'default') {" +
            "MathJax.Hub.Register.StartupHook('HTML-CSS Jax Ready',function () {" +
                "var VARIANT = MathJax.OutputJax['HTML-CSS'].FONTDATA.VARIANT;" +
                "VARIANT['normal'].fonts.unshift('MathJax_default');" +
                "VARIANT['bold'].fonts.unshift('MathJax_default-bold');" +
                "VARIANT['italic'].fonts.unshift('MathJax_default-italic');" +
                "VARIANT['-tex-mathit'].fonts.unshift('MathJax_default-italic');" +
            "});" +
            "MathJax.Hub.Register.StartupHook('SVG Jax Ready',function () {" +
                "var VARIANT = MathJax.OutputJax.SVG.FONTDATA.VARIANT;" +
                "VARIANT['normal'].fonts.unshift('MathJax_default');" +
                "VARIANT['bold'].fonts.unshift('MathJax_default-bold');" +
                "VARIANT['italic'].fonts.unshift('MathJax_default-italic');" +
                "VARIANT['-tex-mathit'].fonts.unshift('MathJax_default-italic');" +
            "});" +
        "}";
    (document.body || document.getElementsByTagName('head')[0]).appendChild(mathjaxscript);
}
&lt;/script&gt;</summary><category term="Math"></category><category term="Mathematical_Nonsense"></category></entry><entry><title>Mathematical Nonsense - Logarithm Equality</title><link href="http://doctrina.org/Mathematical_Nonsense_Lemma-For-Logarithm-Equality.html" rel="alternate"></link><updated>2013-02-06T00:00:00-08:00</updated><author><name>Barry Steyn</name></author><id>tag:doctrina.org,2013-02-06:Mathematical_Nonsense_Lemma-For-Logarithm-Equality.html</id><summary type="html">&lt;p&gt;It's been many years since I was first taught &lt;a href="http://en.wikipedia.org/wiki/Logarithm"&gt;logarithms&lt;/a&gt;&lt;sup class="print"&gt;L1&lt;/sup&gt;. So when looking at a proof that hinged on the fact that &lt;span class="math"&gt;\(a^{log_b n} = n^{log_b a}\)&lt;/span&gt;, I thought that the proof was wrong. Actually, it was my fault: &lt;span class="math"&gt;\(a^{log_b n}\)&lt;/span&gt; is indeed equal to &lt;span class="math"&gt;\(n^{log_b a}\)&lt;/span&gt;, I just forgot.&lt;/p&gt;
&lt;p&gt;And so, I thought I would prove this fact. I am going to call it mathematical nonense, and its just short little lemmas that give me pleasure to prove and to reread.&lt;/p&gt;
&lt;div class="math"&gt;\begin{aligned}
a^{log_b n} &amp;amp;= X &amp;amp; \cr
log_b (a^{log_b n}) &amp;amp;= log_b (X) \cr
log_b n \cdot log_b a&amp;amp;= log_b(X) \cr
log_b a \cdot log_b n&amp;amp;= log_b(X) \cr
log_b n^{log_b a}&amp;amp;= log_b(X) &amp;amp; \cr
n^{log_b a}&amp;amp;= X = a^{log_b n} &amp;amp; \cr
\end{aligned}&lt;/div&gt;
&lt;script type="text/javascript"&gt;if (!document.getElementById('mathjaxscript_pelican_#%@#$@#')) {
    var align = "center",
        indent = "0em",
        linebreak = "true";

    if (true) {
        align = (screen.width &lt; 768) ? "left" : align;
        indent = (screen.width &lt; 768) ? "0em" : indent;
        linebreak = (screen.width &lt; 768) ? 'true' : linebreak;
    }
    
    var mathjaxscript = document.createElement('script');
    mathjaxscript.id = 'mathjaxscript_pelican_#%@#$@#';
    mathjaxscript.type = 'text/javascript';
    mathjaxscript.src = '//cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML';
    mathjaxscript[(window.opera ? "innerHTML" : "text")] =
        "MathJax.Hub.Config({" +
        "    config: ['MMLorHTML.js']," +
        "    TeX: { extensions: ['AMSmath.js','AMSsymbols.js','noErrors.js','noUndefined.js'], equationNumbers: { autoNumber: 'AMS' } }," +
        "    jax: ['input/TeX','input/MathML','output/HTML-CSS']," +
        "    extensions: ['tex2jax.js','mml2jax.js','MathMenu.js','MathZoom.js']," +
        "    displayAlign: '"+ align +"'," +
        "    displayIndent: '"+ indent +"'," +
        "    showMathMenu: true," +
        "    tex2jax: { " +
        "        inlineMath: [ ['\\\\(','\\\\)'] ], " +
        "        displayMath: [ ['$$','$$'] ]," +
        "        processEscapes: true," +
        "        preview: '[math]'," +
        "    }, " +
        "    'HTML-CSS': { " +
        "        styles: { '.MathJax_Display, .MathJax .mo, .MathJax .mi, .MathJax .mn': {color: 'inherit ! important'} }," +
        "        linebreaks: { automatic: "+ linebreak +", width: '90% container' }," +
        "    }, " +
        "}); " +
        "if ('default' !== 'default') {" +
            "MathJax.Hub.Register.StartupHook('HTML-CSS Jax Ready',function () {" +
                "var VARIANT = MathJax.OutputJax['HTML-CSS'].FONTDATA.VARIANT;" +
                "VARIANT['normal'].fonts.unshift('MathJax_default');" +
                "VARIANT['bold'].fonts.unshift('MathJax_default-bold');" +
                "VARIANT['italic'].fonts.unshift('MathJax_default-italic');" +
                "VARIANT['-tex-mathit'].fonts.unshift('MathJax_default-italic');" +
            "});" +
            "MathJax.Hub.Register.StartupHook('SVG Jax Ready',function () {" +
                "var VARIANT = MathJax.OutputJax.SVG.FONTDATA.VARIANT;" +
                "VARIANT['normal'].fonts.unshift('MathJax_default');" +
                "VARIANT['bold'].fonts.unshift('MathJax_default-bold');" +
                "VARIANT['italic'].fonts.unshift('MathJax_default-italic');" +
                "VARIANT['-tex-mathit'].fonts.unshift('MathJax_default-italic');" +
            "});" +
        "}";
    (document.body || document.getElementsByTagName('head')[0]).appendChild(mathjaxscript);
}
&lt;/script&gt;&lt;h2 class="print"&gt;Links&lt;/h2&gt;&lt;div style="margin-left: 2.0em;" class="print"&gt;&lt;ol class="print-links"&gt;&lt;li&gt;http://en.wikipedia.org/wiki/Logarithm&lt;/li&gt;&lt;/ol&gt;&lt;/div&gt;</summary><category term="Math"></category><category term="Mathematical_Nonsense"></category></entry><entry><title>Base64 With OpenSSL C API</title><link href="http://doctrina.org/Base64-With-OpenSSL-C-API.html" rel="alternate"></link><updated>2012-12-19T00:00:00-08:00</updated><author><name>Barry Steyn</name></author><id>tag:doctrina.org,2012-12-19:Base64-With-OpenSSL-C-API.html</id><summary type="html">&lt;p&gt;OpenSSL has the ability to perform &lt;a href="http://en.wikipedia.org/wiki/Base64"&gt;Base64&lt;/a&gt;&lt;sup class="print"&gt;L1&lt;/sup&gt; encodings and decodings. There seems to be many queries for working examples on how to use this functionality. Unfortunately, the &lt;a href="http://www.openssl.org/docs/crypto/BIO_f_base64.html"&gt;example&lt;/a&gt;&lt;sup class="print"&gt;L2&lt;/sup&gt; on the OpenSSL site is quite obtuse, and every other example I have come accross does not work. So here is some &lt;a href="https://gist.github.com/7308212/download"&gt;working code&lt;/a&gt;&lt;sup class="print"&gt;L3&lt;/sup&gt;. Enjoy!&lt;/p&gt;
&lt;h1 id="get-the-code"&gt;Get The Code&lt;a href="#get-the-code" title="Permanent link" class="headerlink"&gt;&lt;/a&gt;&lt;/h1&gt;
&lt;p&gt;You can download this entire gist &lt;a href="https://gist.github.com/7308212/download"&gt;here&lt;/a&gt;&lt;sup class="print"&gt;L3&lt;/sup&gt;. It consists of the following files:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="https://gist.github.com/7308212#file-base64decode-c"&gt;Base64Decode.c&lt;/a&gt;&lt;sup class="print"&gt;L4&lt;/sup&gt; - the decode function (takes Base64 encoded string as input).&lt;/li&gt;
&lt;li&gt;&lt;a href="https://gist.github.com/7308212#file-base64encode-c"&gt;Base64Encode.c&lt;/a&gt;&lt;sup class="print"&gt;L5&lt;/sup&gt; - the encode function (takes a "normal" string as input).&lt;/li&gt;
&lt;li&gt;&lt;a href="https://gist.github.com/7308212#file-main-c"&gt;Main.c&lt;/a&gt;&lt;sup class="print"&gt;L6&lt;/sup&gt; - the main c file that demonstrates usage of the functionality in the two files above.&lt;/li&gt;
&lt;li&gt;&lt;a href="https://gist.github.com/7308212#file-makefile"&gt;Makefile&lt;/a&gt;&lt;sup class="print"&gt;L7&lt;/sup&gt; - the C makefile. Compilation has been tested on a linux ubuntu distribution, and links with &lt;code&gt;lcrypto&lt;/code&gt; for &lt;a href="http://www.openssl.org/"&gt;opensll&lt;/a&gt;&lt;sup class="print"&gt;L8&lt;/sup&gt; and &lt;code&gt;lm&lt;/code&gt; for math.&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id="base64-encoding"&gt;Base64 Encoding&lt;a href="#base64-encoding" title="Permanent link" class="headerlink"&gt;&lt;/a&gt;&lt;/h1&gt;
&lt;p&gt;&lt;script src="https://gist.github.com/7308212.js?file=Base64Encode.c"&gt;&lt;/script&gt;&lt;/p&gt;
&lt;h1 id="base64-decoding"&gt;Base64 Decoding&lt;a href="#base64-decoding" title="Permanent link" class="headerlink"&gt;&lt;/a&gt;&lt;/h1&gt;
&lt;p&gt;&lt;script src="https://gist.github.com/7308212.js?file=Base64Decode.c"&gt;&lt;/script&gt;&lt;/p&gt;
&lt;p&gt;Note the following:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;It is important to set the flag &lt;code&gt;BIO_FLAGS_BASE64_NO_NL&lt;/code&gt;. If this is not done, the read operation will block until a newline character (&lt;code&gt;\n&lt;/code&gt;) is encountered.&lt;/li&gt;
&lt;li&gt;The function &lt;code&gt;calcDecodeLength&lt;/code&gt; will, given a Base64 encoded input string, calculate the length of the decoded string. Base64 encodes a "normal" 8 bit character string by using only 6 bits (hence only &lt;span class="math"&gt;\(2^6=64\)&lt;/span&gt; characters are needed). Therefore every 4 characters of Base64 decodes to three decoded characters, and multiplying the length of the Base64 string by &lt;span class="math"&gt;\(\frac{3}{4}\)&lt;/span&gt; will typically suffice. There are however two exceptions due to padding denoted by the &lt;code&gt;=&lt;/code&gt; character. For more information, read &lt;a href="http://en.wikipedia.org/wiki/Base64#Decoding_Base64_with_padding"&gt;decoding base64 with padding&lt;/a&gt;&lt;sup class="print"&gt;L9&lt;/sup&gt;.&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id="usage"&gt;Usage&lt;a href="#usage" title="Permanent link" class="headerlink"&gt;&lt;/a&gt;&lt;/h1&gt;
&lt;p&gt;The above functionality is used like so:
&lt;script src="https://gist.github.com/7308212.js?file=Main.c"&gt;&lt;/script&gt;&lt;/p&gt;
&lt;p&gt;Compile it with this MakeFile:
&lt;script src="https://gist.github.com/7308212.js?file=Makefile"&gt;&lt;/script&gt;&lt;/p&gt;
&lt;h1 id="memory-stuff"&gt;Memory Stuff&lt;a href="#memory-stuff" title="Permanent link" class="headerlink"&gt;&lt;/a&gt;&lt;/h1&gt;
&lt;p&gt;The memory for &lt;code&gt;buffer&lt;/code&gt; in both functions is created on the heap using &lt;a href="http://www.cplusplus.com/reference/cstdlib/malloc/"&gt;malloc&lt;/a&gt;&lt;sup class="print"&gt;L10&lt;/sup&gt;. Therefore, it must be managed. This is a tiny example, and the program ends before any memory leaks become a problem, but in production code, remember to free the heap memory occupied by &lt;code&gt;buffer&lt;/code&gt; after it has been used. This is done with the &lt;a href="http://www.cplusplus.com/reference/cstdlib/free/"&gt;free&lt;/a&gt;&lt;sup class="print"&gt;L11&lt;/sup&gt; command.&lt;/p&gt;
&lt;h1 id="conclusion"&gt;Conclusion&lt;a href="#conclusion" title="Permanent link" class="headerlink"&gt;&lt;/a&gt;&lt;/h1&gt;
&lt;p&gt;The above functions should perform better error checking if used in production. It also only works for encoding and decoding of a strings (although it is not too difficult to get it to work for files as well). This should give the inquisitive (and frustrated) programmer a base from which to work from.&lt;/p&gt;
&lt;script type="text/javascript"&gt;if (!document.getElementById('mathjaxscript_pelican_#%@#$@#')) {
    var align = "center",
        indent = "0em",
        linebreak = "true";

    if (true) {
        align = (screen.width &lt; 768) ? "left" : align;
        indent = (screen.width &lt; 768) ? "0em" : indent;
        linebreak = (screen.width &lt; 768) ? 'true' : linebreak;
    }
    
    var mathjaxscript = document.createElement('script');
    mathjaxscript.id = 'mathjaxscript_pelican_#%@#$@#';
    mathjaxscript.type = 'text/javascript';
    mathjaxscript.src = '//cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML';
    mathjaxscript[(window.opera ? "innerHTML" : "text")] =
        "MathJax.Hub.Config({" +
        "    config: ['MMLorHTML.js']," +
        "    TeX: { extensions: ['AMSmath.js','AMSsymbols.js','noErrors.js','noUndefined.js'], equationNumbers: { autoNumber: 'AMS' } }," +
        "    jax: ['input/TeX','input/MathML','output/HTML-CSS']," +
        "    extensions: ['tex2jax.js','mml2jax.js','MathMenu.js','MathZoom.js']," +
        "    displayAlign: '"+ align +"'," +
        "    displayIndent: '"+ indent +"'," +
        "    showMathMenu: true," +
        "    tex2jax: { " +
        "        inlineMath: [ ['\\\\(','\\\\)'] ], " +
        "        displayMath: [ ['$$','$$'] ]," +
        "        processEscapes: true," +
        "        preview: '[math]'," +
        "    }, " +
        "    'HTML-CSS': { " +
        "        styles: { '.MathJax_Display, .MathJax .mo, .MathJax .mi, .MathJax .mn': {color: 'inherit ! important'} }," +
        "        linebreaks: { automatic: "+ linebreak +", width: '90% container' }," +
        "    }, " +
        "}); " +
        "if ('default' !== 'default') {" +
            "MathJax.Hub.Register.StartupHook('HTML-CSS Jax Ready',function () {" +
                "var VARIANT = MathJax.OutputJax['HTML-CSS'].FONTDATA.VARIANT;" +
                "VARIANT['normal'].fonts.unshift('MathJax_default');" +
                "VARIANT['bold'].fonts.unshift('MathJax_default-bold');" +
                "VARIANT['italic'].fonts.unshift('MathJax_default-italic');" +
                "VARIANT['-tex-mathit'].fonts.unshift('MathJax_default-italic');" +
            "});" +
            "MathJax.Hub.Register.StartupHook('SVG Jax Ready',function () {" +
                "var VARIANT = MathJax.OutputJax.SVG.FONTDATA.VARIANT;" +
                "VARIANT['normal'].fonts.unshift('MathJax_default');" +
                "VARIANT['bold'].fonts.unshift('MathJax_default-bold');" +
                "VARIANT['italic'].fonts.unshift('MathJax_default-italic');" +
                "VARIANT['-tex-mathit'].fonts.unshift('MathJax_default-italic');" +
            "});" +
        "}";
    (document.body || document.getElementsByTagName('head')[0]).appendChild(mathjaxscript);
}
&lt;/script&gt;&lt;h2 class="print"&gt;Links&lt;/h2&gt;&lt;div style="margin-left: 2.0em;" class="print"&gt;&lt;ol class="print-links"&gt;&lt;li&gt;http://en.wikipedia.org/wiki/Base64&lt;/li&gt;&lt;li&gt;http://www.openssl.org/docs/crypto/BIO_f_base64.html&lt;/li&gt;&lt;li&gt;https://gist.github.com/7308212/download&lt;/li&gt;&lt;li&gt;https://gist.github.com/7308212#file-base64decode-c&lt;/li&gt;&lt;li&gt;https://gist.github.com/7308212#file-base64encode-c&lt;/li&gt;&lt;li&gt;https://gist.github.com/7308212#file-main-c&lt;/li&gt;&lt;li&gt;https://gist.github.com/7308212#file-makefile&lt;/li&gt;&lt;li&gt;http://www.openssl.org/&lt;/li&gt;&lt;li&gt;http://en.wikipedia.org/wiki/Base64#Decoding_Base64_with_padding&lt;/li&gt;&lt;li&gt;http://www.cplusplus.com/reference/cstdlib/malloc/&lt;/li&gt;&lt;li&gt;http://www.cplusplus.com/reference/cstdlib/free/&lt;/li&gt;&lt;/ol&gt;&lt;/div&gt;</summary><category term="Development"></category><category term="OpenSSL"></category></entry><entry><title>Upstart With Python VirtualEnv</title><link href="http://doctrina.org/VirtualEnv-With-Upstart.html" rel="alternate"></link><updated>2012-11-29T00:00:00-08:00</updated><author><name>Barry Steyn</name></author><id>tag:doctrina.org,2012-11-29:VirtualEnv-With-Upstart.html</id><summary type="html">&lt;p&gt;I thought I would write this very short blog article to help anyone who would who wants to launch a &lt;a href="http://projects.unbit.it/uwsgi/"&gt;uwsgi&lt;/a&gt;&lt;sup class="print"&gt;L1&lt;/sup&gt; server that refers to a python script in a virtual environment via upstart.&lt;/p&gt;
&lt;p&gt;In order to run a &lt;a href="http://projects.unbit.it/uwsgi/"&gt;uwsgi&lt;/a&gt;&lt;sup class="print"&gt;L1&lt;/sup&gt; server that runs a python script that in &lt;a href="http://pypi.python.org/pypi/virtualenv"&gt;virtualenv&lt;/a&gt;&lt;sup class="print"&gt;L2&lt;/sup&gt;, the following switches must be defined:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;pythonpath&lt;/strong&gt; - this should be set to the folder where your script lives. Uwsgi uses this switch to define the &lt;a href="http://docs.python.org/2/using/cmdline.html#envvar-PYTHONPATH"&gt;PYTHONPATH&lt;/a&gt;&lt;sup class="print"&gt;L3&lt;/sup&gt; environment variable for the script to be executed.&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;virtualenv&lt;/strong&gt; - this must be set the folder where your virtual environment is defined. It is normally &lt;code&gt;~/.virtualenvs/&amp;lt;name of virtual environment&amp;gt;&lt;/code&gt;. Uwsgi uses this switch to define the &lt;a href="http://docs.python.org/2/using/cmdline.html#envvar-PYTHONHOME"&gt;PYTHONHOME&lt;/a&gt;&lt;sup class="print"&gt;L4&lt;/sup&gt; environment variable for the script to be executed.&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;file&lt;/strong&gt; - this is the file that will be run by uwsgi&lt;/li&gt;
&lt;/ol&gt;
&lt;h1 id="an-upstart-example"&gt;An Upstart Example&lt;a href="#an-upstart-example" title="Permanent link" class="headerlink"&gt;&lt;/a&gt;&lt;/h1&gt;
&lt;p&gt;Lets assume the following:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;pythonpath&lt;/strong&gt; = "/home/dev/python-script"&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;virutalenv&lt;/strong&gt; = "/home/dev/.virtualenvs/python-script"&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;file&lt;/strong&gt; = "/home/dev/python-script/script.py"&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;Then an upstart script to start uwsgi that will run this script in the virutalenv is as follows:
&lt;script src="https://gist.github.com/4469288.js"&gt;&lt;/script&gt;&lt;/p&gt;
&lt;p&gt;There are many options that one can give uwsgi. The above example is running a flask app, and therefore uses the &lt;code&gt;--callable&lt;/code&gt; switch (although your particular needs should be defined by the documentation).&lt;/p&gt;&lt;h2 class="print"&gt;Links&lt;/h2&gt;&lt;div style="margin-left: 2.0em;" class="print"&gt;&lt;ol class="print-links"&gt;&lt;li&gt;http://projects.unbit.it/uwsgi/&lt;/li&gt;&lt;li&gt;http://pypi.python.org/pypi/virtualenv&lt;/li&gt;&lt;li&gt;http://docs.python.org/2/using/cmdline.html#envvar-PYTHONPATH&lt;/li&gt;&lt;li&gt;http://docs.python.org/2/using/cmdline.html#envvar-PYTHONHOME&lt;/li&gt;&lt;/ol&gt;&lt;/div&gt;</summary><category term="System Administration"></category></entry><entry><title>JavaScript: Why Understanding Scope And Closures Matter</title><link href="http://doctrina.org/JavaScript:Why-Understanding-Scope-And-Closures-Matter.html" rel="alternate"></link><updated>2012-10-26T00:00:00-07:00</updated><author><name>Barry Steyn</name></author><id>tag:doctrina.org,2012-10-26:JavaScript:Why-Understanding-Scope-And-Closures-Matter.html</id><summary type="html">&lt;p&gt;When first learning how to program, a fundamental aspect is to learn about scope. Many languages copy the C &lt;em&gt;syntax&lt;/em&gt; for scope, including JavaScript. But while these language copy the C rules for scope, JavaScript does not. This results in frustration and potentially problematic code. JavaScript instead implements scope in a way that forces programmers to think a little differently.&lt;/p&gt;
&lt;p&gt;This post will explain how JavaScript implements scope and explains a very useful result of its scoping: Closures. It motivates the utility of JavaScript's scope model by explaining its role in asynchronous programming.&lt;/p&gt;
&lt;h1 id="scope"&gt;Scope&lt;a href="#scope" title="Permanent link" class="headerlink"&gt;&lt;/a&gt;&lt;/h1&gt;
&lt;p&gt;C implements scope using the block operators: &lt;code&gt;{}&lt;/code&gt;. The type of scope it implements is called &lt;em&gt;block scope&lt;/em&gt; and where ever the block operators &lt;code&gt;{}&lt;/code&gt; are declared, the compiler will create scope. Languages (besides JavaScript) that copy this notation follow more-or-less the same block scope rules (e.g. Java).&lt;/p&gt;
&lt;p&gt;JavaScript uses block operators &lt;code&gt;{}&lt;/code&gt; but it does &lt;strong&gt;not&lt;/strong&gt; implement block scope. Coming from C/C++, the following code makes perfect sense (&lt;em&gt;please do not try run this JavaScript code&lt;/em&gt;):&lt;/p&gt;
&lt;table class="highlighttable"&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class="linenos"&gt;&lt;div class="linenodiv"&gt;&lt;pre&gt;1
2
3
4
5&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;td class="code"&gt;&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="k"&gt;for&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;i&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt; &lt;span class="n"&gt;i&lt;/span&gt; &lt;span class="o"&gt;&amp;lt;&lt;/span&gt; &lt;span class="mi"&gt;4&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt; &lt;span class="n"&gt;i&lt;/span&gt;&lt;span class="o"&gt;++&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt; &lt;span class="c1"&gt;//Outer loop&lt;/span&gt;
    &lt;span class="k"&gt;for&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;i&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt; &lt;span class="n"&gt;i&lt;/span&gt; &lt;span class="o"&gt;&amp;lt;&lt;/span&gt; &lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt; &lt;span class="n"&gt;i&lt;/span&gt;&lt;span class="o"&gt;++&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt; &lt;span class="c1"&gt;//Inner loop&lt;/span&gt;
        &lt;span class="n"&gt;document&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;write&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;"Hello World"&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt; 
    &lt;span class="p"&gt;}&lt;/span&gt;
&lt;span class="p"&gt;}&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;

&lt;p&gt;Firstly, note that the above will cause an error in Java, but in C/C++ (whose scope syntax JavaScript has copied), it works fine. This looks like it will output &lt;code&gt;Hello World&lt;/code&gt; eight times. It won't! It will instead loop endlessly, outputting &lt;code&gt;Hello World&lt;/code&gt; forever. This is because JavaScript does not implement &lt;em&gt;block scope&lt;/em&gt;; the &lt;code&gt;i&lt;/code&gt; of the inner loop keeps resetting the &lt;code&gt;i&lt;/code&gt; of the outer loop, and so the outer loop's end condition is never achieved. This is confusing for people experienced with block scope, and JavaScript should have copied the block scope rules if it copied the operators. JavaScript realises their mistake and so the &lt;a href="http://wiki.ecmascript.org/doku.php?id=harmony:let"&gt;let&lt;/a&gt;&lt;sup class="print"&gt;L1&lt;/sup&gt; operator, which implements block scope, has been approved for future JavaScript releases. &lt;/p&gt;
&lt;p&gt;I feel that adding block scope solves the problem in a haphazard way. Firstly, it alters the way block scope in the C style is used, and secondly, it will entice programmers with experience of block scope to use &lt;code&gt;let&lt;/code&gt; instead of something better.&lt;/p&gt;
&lt;p&gt;But is there &lt;em&gt;something better&lt;/em&gt;? Scope has traditionally been implemented in JavaScript via functions and is known as &lt;em&gt;function scope&lt;/em&gt;. There is an argument to be made that when used correctly, function scope can be very elegant and achieve most of what block scope does. But first, an explanation of function scope is in order...&lt;/p&gt;
&lt;h3 id="function-scope"&gt;Function Scope&lt;a href="#function-scope" title="Permanent link" class="headerlink"&gt;&lt;/a&gt;&lt;/h3&gt;
&lt;p&gt;Function scope means that everything between bracket operators &lt;code&gt;{}&lt;/code&gt; is scoped &lt;em&gt;as long as it is part of a function&lt;/em&gt;.&lt;/p&gt;
&lt;table class="highlighttable"&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class="linenos"&gt;&lt;div class="linenodiv"&gt;&lt;pre&gt;1
2
3
4
5
6
7
8&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;td class="code"&gt;&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="kd"&gt;var&lt;/span&gt; &lt;span class="nx"&gt;foo&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s2"&gt;"Goodbye"&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;span class="kd"&gt;var&lt;/span&gt; &lt;span class="nx"&gt;message&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="kd"&gt;function&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
    &lt;span class="kd"&gt;var&lt;/span&gt; &lt;span class="nx"&gt;foo&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s2"&gt;"Hello"&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
    &lt;span class="nb"&gt;document&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;write&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;foo&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
&lt;span class="p"&gt;}&lt;/span&gt;

&lt;span class="nx"&gt;message&lt;/span&gt;&lt;span class="p"&gt;();&lt;/span&gt; &lt;span class="c1"&gt;//Hello&lt;/span&gt;
&lt;span class="nb"&gt;document&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;write&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;foo&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt; &lt;span class="c1"&gt;//Goodbye&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;

&lt;p&gt;The code snippet above demonstrates function scoping: inside the function &lt;code&gt;message&lt;/code&gt;, the variable &lt;code&gt;foo&lt;/code&gt; is scoped and is distinct to the variable &lt;code&gt;foo&lt;/code&gt; outside the function. &lt;em&gt;Function scope&lt;/em&gt; is used heavily in JavaScript. In fact, there is a common pattern to create a function just for the purpose of scope. As an example, the standard advice for writing JQuery plugins is to use the following pattern:&lt;/p&gt;
&lt;table class="highlighttable"&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class="linenos"&gt;&lt;div class="linenodiv"&gt;&lt;pre&gt;1
2
3&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;td class="code"&gt;&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="kd"&gt;function&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;$&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
    &lt;span class="c1"&gt;//Do things here - they are scoped&lt;/span&gt;
&lt;span class="p"&gt;}(&lt;/span&gt;&lt;span class="nx"&gt;JQuery&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;

&lt;p&gt;In the above example, the last line invokes the function by using the invocation operator &lt;code&gt;()&lt;/code&gt; with the input parameter &lt;code&gt;JQuery&lt;/code&gt;. It immediately executes code inside the function which is scoped. In JQuery, a short cut for the &lt;code&gt;JQuery&lt;/code&gt; function is &lt;code&gt;$&lt;/code&gt;. Unfortunately, &lt;code&gt;$&lt;/code&gt; is a shortcut for other JavaScript libraries as well (e.g. ProtoTypeJS). To prevent polluting the global namespace with JQuery's &lt;code&gt;$&lt;/code&gt; (and also avoiding clashes with plugins that may be written for other JavaScript libraries), &lt;em&gt;scope&lt;/em&gt; is required. The above code snippet achieves the desired scope.&lt;/p&gt;
&lt;h3 id="functions-within-functions"&gt;Functions Within Functions&lt;a href="#functions-within-functions" title="Permanent link" class="headerlink"&gt;&lt;/a&gt;&lt;/h3&gt;
&lt;p&gt;Since functions have scope, declaring a function within another function provides another level of scope:&lt;/p&gt;
&lt;table class="highlighttable"&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class="linenos"&gt;&lt;div class="linenodiv"&gt;&lt;pre&gt; 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;td class="code"&gt;&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="kd"&gt;var&lt;/span&gt; &lt;span class="nx"&gt;func1&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="kd"&gt;function&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt; &lt;span class="c1"&gt;//outer function&lt;/span&gt;
    &lt;span class="kd"&gt;var&lt;/span&gt; &lt;span class="nx"&gt;msg&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s2"&gt;"foo"&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;

    &lt;span class="kd"&gt;var&lt;/span&gt; &lt;span class="nx"&gt;func2&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="kd"&gt;function&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt; &lt;span class="c1"&gt;//inner function&lt;/span&gt;
        &lt;span class="kd"&gt;var&lt;/span&gt; &lt;span class="nx"&gt;msg&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s2"&gt;"bar"&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
        &lt;span class="nb"&gt;document&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;write&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;msg&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt; &lt;span class="c1"&gt;//bar&lt;/span&gt;
    &lt;span class="p"&gt;}&lt;/span&gt;

    &lt;span class="nx"&gt;func2&lt;/span&gt;&lt;span class="p"&gt;();&lt;/span&gt;
    &lt;span class="nb"&gt;document&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;write&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;msg&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt; &lt;span class="c1"&gt;//foo&lt;/span&gt;
&lt;span class="p"&gt;}&lt;/span&gt;
&lt;span class="nx"&gt;func1&lt;/span&gt;&lt;span class="p"&gt;();&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;

&lt;p&gt;I will use the term &lt;em&gt;inner function&lt;/em&gt; to mean a function declared within another function and &lt;em&gt;outer function&lt;/em&gt; to refer to the function it is declared in (see code snippet above). &lt;/p&gt;
&lt;p&gt;In addition to its own scope, an inner function has access to the variables of the outer function as long as it does not declare variables with identical names (in which case it will overwrite the variables, but just within that function scope). For example:&lt;/p&gt;
&lt;table class="highlighttable"&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class="linenos"&gt;&lt;div class="linenodiv"&gt;&lt;pre&gt;1
2
3
4
5
6
7
8&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;td class="code"&gt;&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="kd"&gt;var&lt;/span&gt; &lt;span class="nx"&gt;foo&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="kd"&gt;function&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
    &lt;span class="kd"&gt;var&lt;/span&gt; &lt;span class="nx"&gt;msg&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s2"&gt;"bar"&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;

    &lt;span class="kd"&gt;var&lt;/span&gt; &lt;span class="nx"&gt;inner&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="kd"&gt;function&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
        &lt;span class="nb"&gt;document&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;write&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;msg&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt; &lt;span class="c1"&gt;//bar - msg can be accessed here&lt;/span&gt;
    &lt;span class="p"&gt;}&lt;/span&gt;
&lt;span class="p"&gt;}&lt;/span&gt;
&lt;span class="nx"&gt;foo&lt;/span&gt;&lt;span class="p"&gt;();&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;

&lt;p&gt;The above seems intuitive and obvious, and I understand the reader not being &lt;em&gt;blown away&lt;/em&gt; by its utility. But the pattern of having an inner function that has access to an outer function's variable is the basis of a closure, which is very useful.&lt;/p&gt;
&lt;h1 id="closures"&gt;Closures &lt;a id="closures"&gt;&lt;/a&gt;&lt;a href="#closures" title="Permanent link" class="headerlink"&gt;&lt;/a&gt;&lt;/h1&gt;
&lt;h2 id="a-technical-definition"&gt;A Technical Definition&lt;a href="#a-technical-definition" title="Permanent link" class="headerlink"&gt;&lt;/a&gt;&lt;/h2&gt;
&lt;p&gt;A variable that is assigned to a function is a &lt;em&gt;structure&lt;/em&gt; in memory that is used to represent the function. For many languages, this &lt;em&gt;structure&lt;/em&gt; is the memory address of the function, resulting in the variable only being able to invoke the function. Some languages like JavaScript implement a slightly more complex setup for the &lt;em&gt;structure&lt;/em&gt;. For these languages, the &lt;em&gt;structure&lt;/em&gt; holds both the address of the function and its &lt;em&gt;referencing environment&lt;/em&gt;. The referencing environment means the environment the function was originally declared in. If the function was originally declared within another function, then the referencing environment will mean the function that the original function was declared in.&lt;/p&gt;
&lt;p&gt;Having access to the referencing environment means access to certain non-local variables. Normally, a function has access to its own local variables and to the global variables. With the &lt;em&gt;referencing environment&lt;/em&gt; at the structure's disposal, calls to certain non-local variables (i.e. variables that were not declared in the function, but were declared in the function where it was defined) are possible. JavaScript implementors refer to the &lt;em&gt;referencing environment&lt;/em&gt; as the function's &lt;em&gt;context&lt;/em&gt;. When the &lt;em&gt;structure&lt;/em&gt; that points to a function also contains its original context (&lt;em&gt;referencing environment&lt;/em&gt;), it is called a closure. The image below demonstrates the concept, whereby the &lt;em&gt;context&lt;/em&gt; points to the original function (outer) that the function variable inner was declared in:&lt;/p&gt;
&lt;p&gt;&lt;img src="images/closure.png"&gt;&lt;/p&gt;
&lt;h2 id="how-closures-work-and-are-used-not-too-technical"&gt;How Closures Work And Are Used (Not Too Technical)&lt;a href="#how-closures-work-and-are-used-not-too-technical" title="Permanent link" class="headerlink"&gt;&lt;/a&gt;&lt;/h2&gt;
&lt;p&gt;In more laymen's terms, an inner function defined within an outer function has access to all variables within the outer function. In JavaScript, the inner function is a closure because JavaScript includes its &lt;em&gt;context&lt;/em&gt;. Both the inner and outer functions are scoped.&lt;/p&gt;
&lt;table class="highlighttable"&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class="linenos"&gt;&lt;div class="linenodiv"&gt;&lt;pre&gt; 1
 2
 3
 4
 5
 6
 7
 8
 9
10&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;td class="code"&gt;&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="kd"&gt;var&lt;/span&gt; &lt;span class="nx"&gt;closureExample&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="kd"&gt;function&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt; &lt;span class="c1"&gt;//outer function&lt;/span&gt;
    &lt;span class="c1"&gt;//declare variables within the outer function&lt;/span&gt;

    &lt;span class="kd"&gt;var&lt;/span&gt; &lt;span class="nx"&gt;closureFunction&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="kd"&gt;function&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt; &lt;span class="c1"&gt;//inner function&lt;/span&gt;
        &lt;span class="c1"&gt;//Do things here, and have access to outer function's stuff&lt;/span&gt;
    &lt;span class="p"&gt;}&lt;/span&gt;

    &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="nx"&gt;closureFunction&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;span class="p"&gt;}&lt;/span&gt;
&lt;span class="kd"&gt;var&lt;/span&gt; &lt;span class="nx"&gt;closure&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nx"&gt;closureExample&lt;/span&gt;&lt;span class="p"&gt;();&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;

&lt;p&gt;When presented like this, closures do not seem interesting. But, when the &lt;em&gt;inner&lt;/em&gt; function lives longer than the &lt;em&gt;outer&lt;/em&gt; function, the inner function (i.e. the closure) will have access to state from that outer function that is not accessible anywhere else. Therefore closures have the ability to implement something that is taken for granted in classical object oriented languages: &lt;em&gt;Private State&lt;/em&gt;.&lt;/p&gt;
&lt;h3 id="keeping-things-private"&gt;Keeping Things Private&lt;a href="#keeping-things-private" title="Permanent link" class="headerlink"&gt;&lt;/a&gt;&lt;/h3&gt;
&lt;p&gt;In a classical object oriented language, it is easy to keep methods and state private: Put the &lt;code&gt;private&lt;/code&gt; keyword in front of such state and methods. Modern object oriented scripting languages do not have this functionality. In that sense, JavaScript is in good company with the likes of Python and Ruby.&lt;/p&gt;
&lt;p&gt;But private state and methods are very useful at times. And it can be achieved in JavaScript by using a closure:&lt;/p&gt;
&lt;table class="highlighttable"&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class="linenos"&gt;&lt;div class="linenodiv"&gt;&lt;pre&gt; 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;td class="code"&gt;&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="kd"&gt;var&lt;/span&gt; &lt;span class="nx"&gt;closure&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="kd"&gt;function&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
    &lt;span class="c1"&gt;//This is a private variable&lt;/span&gt;
    &lt;span class="kd"&gt;var&lt;/span&gt; &lt;span class="nx"&gt;counter&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;

    &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt; &lt;span class="c1"&gt;//This object being returned is assigned to closure&lt;/span&gt;
        &lt;span class="nx"&gt;getCounter&lt;/span&gt; &lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="kd"&gt;function&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt; &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="nx"&gt;counter&lt;/span&gt;&lt;span class="p"&gt;;},&lt;/span&gt;
        &lt;span class="nx"&gt;increment&lt;/span&gt; &lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="kd"&gt;function&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;inc&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
            &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="k"&gt;typeof&lt;/span&gt; &lt;span class="nx"&gt;inc&lt;/span&gt; &lt;span class="o"&gt;!==&lt;/span&gt; &lt;span class="s1"&gt;'number'&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
                &lt;span class="nx"&gt;inc&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;

            &lt;span class="nx"&gt;counter&lt;/span&gt; &lt;span class="o"&gt;+=&lt;/span&gt; &lt;span class="nx"&gt;inc&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
        &lt;span class="p"&gt;}&lt;/span&gt;
    &lt;span class="p"&gt;};&lt;/span&gt;
&lt;span class="p"&gt;}();&lt;/span&gt;

&lt;span class="nx"&gt;closure&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;increment&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;10&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
&lt;span class="nx"&gt;alert&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;closure&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;getCounter&lt;/span&gt;&lt;span class="p"&gt;());&lt;/span&gt; &lt;span class="c1"&gt;//10&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;

&lt;p&gt;There is a lot of things happening in the above example:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;First, notice on the last line the &lt;code&gt;();&lt;/code&gt; - the function is being invoked, the result of which is being assigned to &lt;code&gt;closure&lt;/code&gt;. To hammer this point home: We are &lt;strong&gt;not&lt;/strong&gt; assigning the variable &lt;code&gt;closure&lt;/code&gt; to a function, we are instead assigning it the result of the invoked function (what is returned from the function). This common pattern was mentioned above whereby a function is created only to create scope.&lt;/li&gt;
&lt;li&gt;The result assigned to &lt;code&gt;closure&lt;/code&gt; is an &lt;a href="http://doctrina.org/Javascript-Objects-Prototypes.html#cofl"&gt;Object Literal&lt;/a&gt;&lt;sup class="print"&gt;L2&lt;/sup&gt; that consists of two functions which are closures. They are closures because they have access to the context in which they were declared.&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;In the code snippet above, once the outer function is invoked it cannot be accessed again because it is an anonymous function. The pattern of an &lt;em&gt;inner&lt;/em&gt; function living longer than the outer function &lt;em&gt;is the useful pattern for closures&lt;/em&gt; because it implements private state. The two closure functions within the object assigned to &lt;code&gt;closure&lt;/code&gt; have access to &lt;code&gt;counter&lt;/code&gt;. &lt;code&gt;counter&lt;/code&gt; is private: It cannot be altered nor accessed except through the closure functions. &lt;/p&gt;
&lt;p&gt;I will say it again: Closure functions are interesting when the &lt;em&gt;inner&lt;/em&gt; functions "outlives" the &lt;em&gt;outer&lt;/em&gt; object where it was declared. This is specially useful for asynchronicity.&lt;/p&gt;
&lt;h1 id="why-closures-are-so-useful-the-big-picture"&gt;Why Closures Are So Useful: The Big Picture&lt;a href="#why-closures-are-so-useful-the-big-picture" title="Permanent link" class="headerlink"&gt;&lt;/a&gt;&lt;/h1&gt;
&lt;p&gt;One of JavaScript's most appealing features is that it is asynchronous from "the ground up". Asynchronicity is achieved by using an &lt;em&gt;event driven programming model&lt;/em&gt;: A function is executed only when an event occurs. That function is passed as an argument to the event handler. Functions used in this manner are called &lt;em&gt;callback&lt;/em&gt; functions. The &lt;em&gt;callback&lt;/em&gt; function, like any JavaScript function, will have access to the context where it was declared in. If the callback function is an inner function, it is a closure that is able to access variables in the outer function. As was shown above, closures can be used to maintain private state. So by using closure callback functions, you get the best of both worlds: &lt;strong&gt;You can implement event driven programming without having to maintain any state by passing it via the event handler&lt;/strong&gt;. This is extremely elegant and will decrease programmer errors. And this is a killer reason (amongst others I am sure) that function scope along with closures are so useful. &lt;/p&gt;
&lt;p&gt;JavaScript should not be used like classical object oriented languages. Its power lies in the fact that it should be able to handle more load (on both the server and the client) by using an event driven approach that does not block IO. Therefore I think the JavaScript programmer should be thinking in callback functions that are closures. And for this, function scope becomes essential and in a way, elegant.&lt;/p&gt;
&lt;h2 id="watch-out-callbacks-and-closures-sometimes-do-not-play-nicely"&gt;Watch Out: Callbacks And Closures Sometimes Do Not Play Nicely &lt;a id="closureandconstructor"&gt;&lt;/a&gt;&lt;a href="#watch-out-callbacks-and-closures-sometimes-do-not-play-nicely" title="Permanent link" class="headerlink"&gt;&lt;/a&gt;&lt;/h2&gt;
&lt;p&gt;Of course there are always &lt;em&gt;gotchas&lt;/em&gt; with JavaScript. Lets define a callback function:&lt;/p&gt;
&lt;table class="highlighttable"&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class="linenos"&gt;&lt;div class="linenodiv"&gt;&lt;pre&gt; 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;td class="code"&gt;&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="kd"&gt;var&lt;/span&gt; &lt;span class="nx"&gt;createCallBack&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="kd"&gt;function&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt; &lt;span class="c1"&gt;//First function&lt;/span&gt;
    &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="k"&gt;new&lt;/span&gt; &lt;span class="kd"&gt;function&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt; &lt;span class="c1"&gt;//Second function&lt;/span&gt;
        &lt;span class="k"&gt;this&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;message&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s2"&gt;"Hello World"&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;

        &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="kd"&gt;function&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt; &lt;span class="c1"&gt;//Third function&lt;/span&gt;
            &lt;span class="nx"&gt;alert&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="k"&gt;this&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;message&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
        &lt;span class="p"&gt;}&lt;/span&gt;
    &lt;span class="p"&gt;}&lt;/span&gt;
&lt;span class="p"&gt;}&lt;/span&gt;

&lt;span class="nb"&gt;window&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;onload&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nx"&gt;createCallBack&lt;/span&gt;&lt;span class="p"&gt;();&lt;/span&gt; &lt;span class="c1"&gt;//Invoke the function assigned to createCallBack&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;

&lt;p&gt;Lets examine the above code. There are three &lt;code&gt;function&lt;/code&gt; operators:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;The first &lt;code&gt;function&lt;/code&gt; operator creates a &lt;em&gt;function object&lt;/em&gt; and is assigned to &lt;code&gt;creatCallBack&lt;/code&gt;.&lt;/li&gt;
&lt;li&gt;The second &lt;code&gt;function&lt;/code&gt; operator uses the &lt;a href="http://doctrina.org/Javascript-Function-Invocation-Patterns.html#ci"&gt;constructor invocation pattern&lt;/a&gt;&lt;sup class="print"&gt;L3&lt;/sup&gt; to create a new object.&lt;/li&gt;
&lt;li&gt;The third &lt;code&gt;function&lt;/code&gt; operator is the result of the return statement. It is a &lt;em&gt;function object&lt;/em&gt; and because it is an instance of &lt;code&gt;Object&lt;/code&gt;, it gets returned instead of a new object (even though though the function was invoked with &lt;code&gt;new&lt;/code&gt; - read &lt;a href="http://doctrina.org/Javascript-Function-Invocation-Patterns.html#ci"&gt;constructor invocation pattern&lt;/a&gt;&lt;sup class="print"&gt;L3&lt;/sup&gt; for more info).&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;When invoking the &lt;code&gt;createCallBack&lt;/code&gt; variable, what gets passed to the &lt;code&gt;window.onload&lt;/code&gt; event handler is the result of what is returned by the &lt;em&gt;seond&lt;/em&gt; &lt;code&gt;function&lt;/code&gt; operator, which is the code in the &lt;em&gt;third&lt;/em&gt; &lt;code&gt;function&lt;/code&gt; operator. Did you get that? Read this paragraph again until you understand, and if not, stick this code into your browser and play with it.&lt;/p&gt;
&lt;p&gt;The above code looks alright, except that &lt;em&gt;undefined&lt;/em&gt; gets alerted to the screen (try it for yourself). It turns out that when an event handler invokes a callback function, the &lt;a href="http://doctrina.org/Javascript-Function-Invocation-Patterns.html#fi"&gt;function invocation pattern&lt;/a&gt;&lt;sup class="print"&gt;L4&lt;/sup&gt; is used. This results in the &lt;code&gt;this&lt;/code&gt; parameter being bound to the &lt;code&gt;global object&lt;/code&gt; (it is one of the pitfalls of the &lt;a href="http://doctrina.org/Javascript-Function-Invocation-Patterns.html#fi"&gt;function invocation pattern&lt;/a&gt;&lt;sup class="print"&gt;L4&lt;/sup&gt;) instead of to the object that was created with the &lt;a href="http://doctrina.org/Javascript-Function-Invocation-Patterns.html#ci"&gt;constructor invocation pattern&lt;/a&gt;&lt;sup class="print"&gt;L3&lt;/sup&gt;. To note that this problem only occurs when one uses the &lt;a href="http://doctrina.org/Javascript-Function-Invocation-Patterns.html#ci"&gt;constructor invocation pattern&lt;/a&gt;&lt;sup class="print"&gt;L3&lt;/sup&gt; with callbacks like I have illustrated above. To get around this, apply the &lt;a href="http://doctrina.org/Javascript-Function-Invocation-Patterns.html#standardfix"&gt;standard fix&lt;/a&gt;&lt;sup class="print"&gt;L5&lt;/sup&gt; for function invocation by declaring a &lt;code&gt;that&lt;/code&gt; variable to point to &lt;code&gt;this&lt;/code&gt;:&lt;/p&gt;
&lt;table class="highlighttable"&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class="linenos"&gt;&lt;div class="linenodiv"&gt;&lt;pre&gt; 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;td class="code"&gt;&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="kd"&gt;var&lt;/span&gt; &lt;span class="nx"&gt;createCallBack&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="kd"&gt;function&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt; &lt;span class="c1"&gt;//First function&lt;/span&gt;
    &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="k"&gt;new&lt;/span&gt; &lt;span class="kd"&gt;function&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt; &lt;span class="c1"&gt;//Second function&lt;/span&gt;
        &lt;span class="kd"&gt;var&lt;/span&gt; &lt;span class="nx"&gt;that&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="k"&gt;this&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
        &lt;span class="k"&gt;this&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;message&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s2"&gt;"Hello World"&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;

        &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="kd"&gt;function&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt; &lt;span class="c1"&gt;//Third function&lt;/span&gt;
            &lt;span class="nx"&gt;alert&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;that&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;message&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
        &lt;span class="p"&gt;}&lt;/span&gt;
    &lt;span class="p"&gt;}&lt;/span&gt;
&lt;span class="p"&gt;}&lt;/span&gt;

&lt;span class="nb"&gt;window&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;onload&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nx"&gt;createCallBack&lt;/span&gt;&lt;span class="p"&gt;();&lt;/span&gt; &lt;span class="c1"&gt;//Invoke the function assigned to createCallBack&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;

&lt;p&gt;Since the function invoked by the event handler (the third function) is a closure, it has access to the &lt;code&gt;that&lt;/code&gt; variable (which is private), and so it has access to the new object created by the constructor invocation pattern.&lt;/p&gt;
&lt;h2 id="why-would-one-want-to-use-the-constructor-invocation-pattern-with-callbacks"&gt;Why Would One Want To Use The Constructor Invocation Pattern With Callbacks?&lt;a href="#why-would-one-want-to-use-the-constructor-invocation-pattern-with-callbacks" title="Permanent link" class="headerlink"&gt;&lt;/a&gt;&lt;/h2&gt;
&lt;p&gt;To tell you the truth, there is no good reason to mix the &lt;a href="http://doctrina.org/Javascript-Function-Invocation-Patterns.html#ci"&gt;constructor invocation pattern&lt;/a&gt;&lt;sup class="print"&gt;L3&lt;/sup&gt; with a callback. I included it above as a pitfall because it is sometimes used (and misused). Using the &lt;a href="http://doctrina.org/Javascript-Function-Invocation-Patterns.html#ci"&gt;constructor invocation pattern&lt;/a&gt;&lt;sup class="print"&gt;L3&lt;/sup&gt; is necessary when one wants to be able to change the default prototype linkings (see &lt;a href="http://doctrina.org/Javascript-Objects-Prototypes.html#coff"&gt;here&lt;/a&gt;&lt;sup class="print"&gt;L6&lt;/sup&gt; for an example of this). This is only necessary when one wants to create objects that are inherited from another object. It is not necessary for creating new objects because new objects can be created via a closure.&lt;/p&gt;
&lt;p&gt;For example, here is a code snippet that uses the &lt;a href="http://doctrina.org/Javascript-Function-Invocation-Patterns.html#ci"&gt;constructor invocation pattern&lt;/a&gt;&lt;sup class="print"&gt;L3&lt;/sup&gt; in order to create separate objects for each callback:&lt;/p&gt;
&lt;table class="highlighttable"&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class="linenos"&gt;&lt;div class="linenodiv"&gt;&lt;pre&gt; 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;td class="code"&gt;&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="kd"&gt;var&lt;/span&gt; &lt;span class="nx"&gt;createCallBack&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="kd"&gt;function&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;init&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt; &lt;span class="c1"&gt;//First function&lt;/span&gt;
    &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="k"&gt;new&lt;/span&gt; &lt;span class="kd"&gt;function&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt; &lt;span class="c1"&gt;//Second function&lt;/span&gt;
        &lt;span class="kd"&gt;var&lt;/span&gt; &lt;span class="nx"&gt;that&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="k"&gt;this&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
        &lt;span class="k"&gt;this&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;message&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nx"&gt;init&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;

        &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="kd"&gt;function&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt; &lt;span class="c1"&gt;//Third function&lt;/span&gt;
            &lt;span class="nx"&gt;alert&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;that&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;message&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
        &lt;span class="p"&gt;}&lt;/span&gt;
    &lt;span class="p"&gt;}&lt;/span&gt;
&lt;span class="p"&gt;}&lt;/span&gt;

&lt;span class="nb"&gt;window&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;addEventListener&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;'load'&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="nx"&gt;createCallBack&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;"First Message"&lt;/span&gt;&lt;span class="p"&gt;));&lt;/span&gt;
&lt;span class="nb"&gt;window&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;addEventListener&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;'load'&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="nx"&gt;createCallBack&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;"Second Message"&lt;/span&gt;&lt;span class="p"&gt;));&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;

&lt;p&gt;But instead of using &lt;a href="http://doctrina.org/Javascript-Function-Invocation-Patterns.html#ci"&gt;constructor invocation pattern&lt;/a&gt;&lt;sup class="print"&gt;L3&lt;/sup&gt;, the snippet can be rewritten by just using closures:&lt;/p&gt;
&lt;table class="highlighttable"&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class="linenos"&gt;&lt;div class="linenodiv"&gt;&lt;pre&gt; 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;td class="code"&gt;&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="kd"&gt;var&lt;/span&gt; &lt;span class="nx"&gt;createCallBack&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="kd"&gt;function&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;init&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt; &lt;span class="c1"&gt;//First function&lt;/span&gt;
    &lt;span class="kd"&gt;var&lt;/span&gt; &lt;span class="nx"&gt;obj&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt; &lt;span class="c1"&gt;//This object is created within the first function and is accessible&lt;/span&gt;
                &lt;span class="c1"&gt;//to the second function due to the closure&lt;/span&gt;
        &lt;span class="s1"&gt;'message'&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="nx"&gt;init&lt;/span&gt;
    &lt;span class="p"&gt;};&lt;/span&gt;

    &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="kd"&gt;function&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt; &lt;span class="c1"&gt;//Second function&lt;/span&gt;
        &lt;span class="nx"&gt;alert&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;obj&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;message&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
    &lt;span class="p"&gt;}&lt;/span&gt;
&lt;span class="p"&gt;}&lt;/span&gt;

&lt;span class="nb"&gt;window&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;addEventListener&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;'load'&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="nx"&gt;createCallBack&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;"First Message"&lt;/span&gt;&lt;span class="p"&gt;));&lt;/span&gt;
&lt;span class="nb"&gt;window&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;addEventListener&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;'load'&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="nx"&gt;createCallBack&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;"Second Message"&lt;/span&gt;&lt;span class="p"&gt;));&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;

&lt;p&gt;The two code snippets above are equivalent, but the latter example is so much more concise and easier to read! Each code snippet demonstrates objects that have their own internal state. The &lt;code&gt;load&lt;/code&gt; event is given two callback functions, each an instance of an object with its own state (note this example may not work for Internet Explorer older than version 9).&lt;/p&gt;
&lt;h1 id="conclusion"&gt;Conclusion&lt;a href="#conclusion" title="Permanent link" class="headerlink"&gt;&lt;/a&gt;&lt;/h1&gt;
&lt;p&gt;Closures make asynchronous programming elegant. In order to understand closures, it is vital to understand &lt;em&gt;function scope&lt;/em&gt;. JavaScript being functionally scoped encourages event driven programming, the mainstay of asynchronicity. &lt;/p&gt;&lt;h2 class="print"&gt;Links&lt;/h2&gt;&lt;div style="margin-left: 2.0em;" class="print"&gt;&lt;ol class="print-links"&gt;&lt;li&gt;http://wiki.ecmascript.org/doku.php?id=harmony:let&lt;/li&gt;&lt;li&gt;http://doctrina.org/Javascript-Objects-Prototypes.html#cofl&lt;/li&gt;&lt;li&gt;http://doctrina.org/Javascript-Function-Invocation-Patterns.html#ci&lt;/li&gt;&lt;li&gt;http://doctrina.org/Javascript-Function-Invocation-Patterns.html#fi&lt;/li&gt;&lt;li&gt;http://doctrina.org/Javascript-Function-Invocation-Patterns.html#standardfix&lt;/li&gt;&lt;li&gt;http://doctrina.org/Javascript-Objects-Prototypes.html#coff&lt;/li&gt;&lt;/ol&gt;&lt;/div&gt;</summary><category term="development"></category><category term="JavaScript"></category></entry><entry><title>JavaScript: Function Invocation Patterns</title><link href="http://doctrina.org/Javascript-Function-Invocation-Patterns.html" rel="alternate"></link><updated>2012-10-19T00:00:00-07:00</updated><author><name>Barry Steyn</name></author><id>tag:doctrina.org,2012-10-19:Javascript-Function-Invocation-Patterns.html</id><summary type="html">&lt;p&gt;JavaScript has been described as a &lt;em&gt;Functional Oriented Language&lt;/em&gt; (this as opposed to Object Oriented Language). The reason is because functions in JavaScript do more than just separate logic into execution units, functions are first class citizens that also provide &lt;a href="http://doctrina.org/JavaScript:Why-Understanding-Scope-And-Closures-Matter.html"&gt;scope&lt;/a&gt;&lt;sup class="print"&gt;L1&lt;/sup&gt; and the ability to create objects. Having such a heavy reliance upon functions is both a blessing and a curse: It's a blessing because it makes the language light weight and fast (the main goal of its original development), but it is a curse because you can very easily shoot yourself in the foot if you don't know what you are doing.&lt;/p&gt;
&lt;p&gt;One concern with JavaScript functions is how different invocation patterns can produce vastly different results. This post explains the four patterns, how to use them and what to watch out for. The four invocation patterns are:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;Method Invocation&lt;/strong&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Function Invocation&lt;/strong&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Constructor Invocation&lt;/strong&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Apply And Call Invocation&lt;/strong&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;h1 id="function-execution"&gt;Function Execution&lt;a href="#function-execution" title="Permanent link" class="headerlink"&gt;&lt;/a&gt;&lt;/h1&gt;
&lt;p&gt;JavaScript (like all languages these days) has the ability to modularise logic in &lt;code&gt;functions&lt;/code&gt; which can be invoked at any point within the execution. Invoking a function suspends execution of the current function, passing controls and parameters to the invoked function. In addition, a parameter called &lt;code&gt;this&lt;/code&gt; is also passed to the function. The invocation operator is a pair of round brackets &lt;code&gt;()&lt;/code&gt;, that can contain zero or more expressions separated by a comma.&lt;/p&gt;
&lt;p&gt;Unfortunately, there is more than one pattern that can be used to invoke functions. These patterns are not &lt;em&gt;nice-to-know&lt;/em&gt;: They are absolutely essential to know. This is because invoking a function with a different pattern can produce a vastly different result. I believe that this is a language design error in JavaScript, and had the language been designed with more thought (and less haste), this would not have been such a big issue.&lt;/p&gt;
&lt;h1 id="the-four-invocation-patterns"&gt;The Four Invocation Patterns&lt;a href="#the-four-invocation-patterns" title="Permanent link" class="headerlink"&gt;&lt;/a&gt;&lt;/h1&gt;
&lt;p&gt;Even though there are is only one &lt;em&gt;invocation operator&lt;/em&gt; &lt;code&gt;()&lt;/code&gt;, there are four &lt;em&gt;invocation patterns&lt;/em&gt;. Each pattern differs in how the &lt;code&gt;this&lt;/code&gt; parameter is initialised. &lt;/p&gt;
&lt;h2 id="method-invocation"&gt;Method Invocation&lt;a href="#method-invocation" title="Permanent link" class="headerlink"&gt;&lt;/a&gt;&lt;/h2&gt;
&lt;p&gt;When a function is part of an object, it is called a &lt;em&gt;method&lt;/em&gt;. Method invocation is the pattern of invoking a function that is part of an object. For example:&lt;/p&gt;
&lt;table class="highlighttable"&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class="linenos"&gt;&lt;div class="linenodiv"&gt;&lt;pre&gt;1
2
3
4
5
6
7
8&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;td class="code"&gt;&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="kd"&gt;var&lt;/span&gt; &lt;span class="nx"&gt;obj&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
    &lt;span class="nx"&gt;value&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
    &lt;span class="nx"&gt;increment&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="kd"&gt;function&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
        &lt;span class="k"&gt;this&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;value&lt;/span&gt;&lt;span class="o"&gt;+=&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
    &lt;span class="p"&gt;}&lt;/span&gt;
&lt;span class="p"&gt;};&lt;/span&gt;

&lt;span class="nx"&gt;obj&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;increment&lt;/span&gt;&lt;span class="p"&gt;();&lt;/span&gt; &lt;span class="c1"&gt;//Method invocation&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;

&lt;p&gt;Method invocation is identified when a function is preceded by &lt;code&gt;object.&lt;/code&gt;, where &lt;code&gt;object&lt;/code&gt; is the name of some object. JavaScript will set the &lt;code&gt;this&lt;/code&gt; parameter to the object where the method was invoked on. In the example above, &lt;code&gt;this&lt;/code&gt; would be set to &lt;code&gt;obj&lt;/code&gt;. JavaScript binds &lt;code&gt;this&lt;/code&gt; at execution (also known as &lt;em&gt;late binding&lt;/em&gt;).&lt;/p&gt;
&lt;h2 id="function-invocation"&gt;Function Invocation &lt;a id="fi"&gt;&lt;/a&gt;&lt;a href="#function-invocation" title="Permanent link" class="headerlink"&gt;&lt;/a&gt;&lt;/h2&gt;
&lt;p&gt;Function invocation is performed by invoking a function using &lt;code&gt;()&lt;/code&gt;:&lt;/p&gt;
&lt;table class="highlighttable"&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class="linenos"&gt;&lt;div class="linenodiv"&gt;&lt;pre&gt;1&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;td class="code"&gt;&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="n"&gt;add&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="mi"&gt;3&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt; &lt;span class="c1"&gt;//5&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;

&lt;p&gt;When using the function invocation pattern, &lt;code&gt;this&lt;/code&gt; is set to the global object. This was a mistake in the JavaScript language! Blindly binding &lt;code&gt;this&lt;/code&gt; to the global object can destroy its current context. It is noticable when using an &lt;em&gt;inner function&lt;/em&gt; within a method function. An example should explain things better: &lt;/p&gt;
&lt;table class="highlighttable"&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class="linenos"&gt;&lt;div class="linenodiv"&gt;&lt;pre&gt; 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;td class="code"&gt;&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="kd"&gt;var&lt;/span&gt; &lt;span class="nx"&gt;value&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="mi"&gt;500&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt; &lt;span class="c1"&gt;//Global variable&lt;/span&gt;
&lt;span class="kd"&gt;var&lt;/span&gt; &lt;span class="nx"&gt;obj&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
    &lt;span class="nx"&gt;value&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
    &lt;span class="nx"&gt;increment&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="kd"&gt;function&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
        &lt;span class="k"&gt;this&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;value&lt;/span&gt;&lt;span class="o"&gt;++&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;

        &lt;span class="kd"&gt;var&lt;/span&gt; &lt;span class="nx"&gt;innerFunction&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="kd"&gt;function&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
            &lt;span class="nx"&gt;alert&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="k"&gt;this&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;value&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
        &lt;span class="p"&gt;}&lt;/span&gt;

        &lt;span class="nx"&gt;innerFunction&lt;/span&gt;&lt;span class="p"&gt;();&lt;/span&gt; &lt;span class="c1"&gt;//Function invocation pattern&lt;/span&gt;
    &lt;span class="p"&gt;}&lt;/span&gt;
&lt;span class="p"&gt;}&lt;/span&gt;
&lt;span class="nx"&gt;obj&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;increment&lt;/span&gt;&lt;span class="p"&gt;();&lt;/span&gt; &lt;span class="c1"&gt;//Method invocation pattern&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;

&lt;p&gt;What do you think will be printed to screen? For those that answered &lt;em&gt;1&lt;/em&gt;, you are wrong (but don't be too hard on yourselves, this is because JavaScript does not do things very well). The real answer is &lt;em&gt;500&lt;/em&gt;. Note that &lt;code&gt;innerFunction&lt;/code&gt; is called using the function invocation pattern, therefore &lt;code&gt;this&lt;/code&gt; is set to the global object. The result is that &lt;em&gt;innerFunction&lt;/em&gt; (again, it is important to note that it is invoked with function pattern) will not have &lt;code&gt;this&lt;/code&gt; set to current object. Instead, it is set to the global object, where &lt;code&gt;value&lt;/code&gt; is defined as &lt;em&gt;500&lt;/em&gt;. I stress that this is bad language design; the increment function was invoked with the method invocation pattern, and so it is natural to assume the &lt;code&gt;this&lt;/code&gt; should always point to the current function when used inside it.&lt;/p&gt;
&lt;p&gt;&lt;a id="standardfix"&gt;&lt;/a&gt;There is an easy way to get round this problem, but it is in my opinion a hack. One gets around this problem by assigning a variable (by convention, it is named &lt;code&gt;that&lt;/code&gt;) to &lt;code&gt;this&lt;/code&gt; inside the function (aside: This works because functions in JavaScript are &lt;a href="http://doctrina.org/JavaScript:Why-Understanding-Scope-And-Closures-Matter.html#closures"&gt;closures&lt;/a&gt;&lt;sup class="print"&gt;L2&lt;/sup&gt;):&lt;/p&gt;
&lt;table class="highlighttable"&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class="linenos"&gt;&lt;div class="linenodiv"&gt;&lt;pre&gt; 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;td class="code"&gt;&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="kd"&gt;var&lt;/span&gt; &lt;span class="nx"&gt;value&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="mi"&gt;500&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt; &lt;span class="c1"&gt;//Global variable&lt;/span&gt;
&lt;span class="kd"&gt;var&lt;/span&gt; &lt;span class="nx"&gt;obj&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
    &lt;span class="nx"&gt;value&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
    &lt;span class="nx"&gt;increment&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="kd"&gt;function&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
        &lt;span class="kd"&gt;var&lt;/span&gt; &lt;span class="nx"&gt;that&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="k"&gt;this&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
        &lt;span class="nx"&gt;that&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;value&lt;/span&gt;&lt;span class="o"&gt;++&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;

        &lt;span class="kd"&gt;var&lt;/span&gt; &lt;span class="nx"&gt;innerFunction&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="kd"&gt;function&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
            &lt;span class="nx"&gt;alert&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;that&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;value&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
        &lt;span class="p"&gt;}&lt;/span&gt;

        &lt;span class="nx"&gt;innerFunction&lt;/span&gt;&lt;span class="p"&gt;();&lt;/span&gt; &lt;span class="c1"&gt;//Function invocation pattern&lt;/span&gt;
    &lt;span class="p"&gt;}&lt;/span&gt;
&lt;span class="p"&gt;}&lt;/span&gt;
&lt;span class="nx"&gt;obj&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;increment&lt;/span&gt;&lt;span class="p"&gt;();&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;

&lt;p&gt;If &lt;code&gt;this&lt;/code&gt; could be bound to the current object whose scope it is called in, function and method invocations would be identical.&lt;/p&gt;
&lt;h2 id="constructor-invocation"&gt;Constructor Invocation &lt;a id="ci"&gt;&lt;/a&gt;&lt;a href="#constructor-invocation" title="Permanent link" class="headerlink"&gt;&lt;/a&gt;&lt;/h2&gt;
&lt;p&gt;&lt;em&gt;Warning&lt;/em&gt;: This is another JavaScript peculiarity! JavaScript is not a classical object oriented language. Instead, it is a prototypical object oriented language, but the creators of JavaScript felt that people with classical object orientation experience (the vast majority) may be unhappy with a purely prototype aproach. This resulted in JavaScript being unsure of its prototypical nature and the worst thing happened: It mixed classical object orientation syntax with its prototypical nature. The result: A mess!&lt;/p&gt;
&lt;p&gt;In classical object orientation, an object is an instantiation of a class. In C++ and Java, this instantiation is performed by using the &lt;code&gt;new&lt;/code&gt; operator. This seems to be the inspiration behind the constructor invocation pattern...&lt;/p&gt;
&lt;p&gt;The constructor invocation pattern involves putting the &lt;code&gt;new&lt;/code&gt; operator just before the function is invoked. For example:&lt;/p&gt;
&lt;table class="highlighttable"&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class="linenos"&gt;&lt;div class="linenodiv"&gt;&lt;pre&gt;1
2
3
4
5
6&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;td class="code"&gt;&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="kd"&gt;var&lt;/span&gt; &lt;span class="nx"&gt;Cheese&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="kd"&gt;function&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;type&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
    &lt;span class="kd"&gt;var&lt;/span&gt; &lt;span class="nx"&gt;cheeseType&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nx"&gt;type&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
    &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="nx"&gt;cheeseType&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;span class="p"&gt;}&lt;/span&gt;

&lt;span class="nx"&gt;cheddar&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="k"&gt;new&lt;/span&gt; &lt;span class="nx"&gt;Cheese&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;"cheddar"&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt; &lt;span class="c1"&gt;//new object returned, not the type.&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;

&lt;p&gt;Even though &lt;code&gt;Cheese&lt;/code&gt; is a function object (and intuitively, one thinks of functions as running modularised pieces of code), we have created a new object by invoking the function with &lt;code&gt;new&lt;/code&gt; in front of it. The &lt;code&gt;this&lt;/code&gt; parameter will be set to the newly created object and the &lt;code&gt;return&lt;/code&gt; operator of the function will have its behaviour altered. Regarding the behaviour of the &lt;code&gt;return&lt;/code&gt; operator in constructor invocation, there are two cases: &lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;If the function returns a simple type (number, string, boolean, null or undefined), the return will be ignored and instead &lt;code&gt;this&lt;/code&gt; will be returned (which is set to the new object).&lt;/li&gt;
&lt;li&gt;If the function returns an instance of &lt;code&gt;Object&lt;/code&gt; (anything other than a simple type), then that object will be returned instead of returning &lt;code&gt;this&lt;/code&gt;. This pattern is not used that often, but it may have utility when used with &lt;a href="http://doctrina.org/JavaScript:Why-Understanding-Scope-And-Closures-Matter.html#closures"&gt;closures&lt;/a&gt;&lt;sup class="print"&gt;L2&lt;/sup&gt;.&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;For example:&lt;/p&gt;
&lt;table class="highlighttable"&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class="linenos"&gt;&lt;div class="linenodiv"&gt;&lt;pre&gt; 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;td class="code"&gt;&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="kd"&gt;var&lt;/span&gt; &lt;span class="nx"&gt;obj&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
    &lt;span class="nx"&gt;data&lt;/span&gt; &lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;"Hello World"&lt;/span&gt;
&lt;span class="p"&gt;}&lt;/span&gt;

&lt;span class="kd"&gt;var&lt;/span&gt; &lt;span class="nx"&gt;Func1&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="kd"&gt;function&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
    &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="nx"&gt;obj&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;span class="p"&gt;}&lt;/span&gt;

&lt;span class="kd"&gt;var&lt;/span&gt; &lt;span class="nx"&gt;Func2&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="kd"&gt;function&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
    &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="s2"&gt;"I am a simple type"&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;span class="p"&gt;}&lt;/span&gt;

&lt;span class="kd"&gt;var&lt;/span&gt; &lt;span class="nx"&gt;f1&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="k"&gt;new&lt;/span&gt; &lt;span class="nx"&gt;Func1&lt;/span&gt;&lt;span class="p"&gt;();&lt;/span&gt; &lt;span class="c1"&gt;//f1 is set to obj&lt;/span&gt;
&lt;span class="kd"&gt;var&lt;/span&gt; &lt;span class="nx"&gt;f2&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="k"&gt;new&lt;/span&gt; &lt;span class="nx"&gt;Func2&lt;/span&gt;&lt;span class="p"&gt;();&lt;/span&gt; &lt;span class="c1"&gt;//f2 is set to a new object&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;

&lt;p&gt;We might ignore the constructor invocation pattern, and just use &lt;a href="http://doctrina.org/Javascript-Objects-Prototypes.html#cofl"&gt;object literals&lt;/a&gt;&lt;sup class="print"&gt;L3&lt;/sup&gt; to make objects, except that the makers of JavaScript have enabled a key feature of their language by using this pattern: Object creation with an arbitrary prototype link (see &lt;a href="http://doctrina.org/Javascript-Objects-Prototypes.html"&gt;previous post&lt;/a&gt;&lt;sup class="print"&gt;L4&lt;/sup&gt; for more details). This pattern is unintuitive and also &lt;a href="http://doctrina.org/Javascript-Objects-Prototypes.html#pcip"&gt;potentially problematic&lt;/a&gt;&lt;sup class="print"&gt;L5&lt;/sup&gt;. There is a &lt;a href="http://doctrina.org/Javascript-Objects-Prototypes.html#remedy"&gt;remedy&lt;/a&gt;&lt;sup class="print"&gt;L6&lt;/sup&gt; which was championed by Douglas Crockford: Augment &lt;code&gt;Object&lt;/code&gt; with a create method that accomplishes what the constructor invocation pattern tries to do. I am happy to note that as of JavaScript 1.8.5, &lt;code&gt;Object.create&lt;/code&gt; is a reality and can be used. Due to legacy, the constructor invocation is still used often, and for backward compatability, will crop up quite frequently.&lt;/p&gt;
&lt;h2 id="apply-and-call-invocation"&gt;Apply And Call Invocation&lt;a href="#apply-and-call-invocation" title="Permanent link" class="headerlink"&gt;&lt;/a&gt;&lt;/h2&gt;
&lt;p&gt;The apply pattern is not as badly thought out as the two preceding patterns. The &lt;code&gt;apply&lt;/code&gt; method allows manual invocation of a function with a means to pass the function an array of parameters and explicitly set the &lt;code&gt;this&lt;/code&gt; parameter. Because functions are first class citizens, they are also objects and hence can have methods (functions) run on it. In fact, every function is linked to &lt;code&gt;Function.prototype&lt;/code&gt; (see &lt;a href="http://doctrina.org/Javascript-Objects-Prototypes.html#cfo"&gt;here&lt;/a&gt;&lt;sup class="print"&gt;L7&lt;/sup&gt; for more details), and so methods can very easily be augmented to any function. The apply method is just an augmentation to every function as - I presume - it is defined on &lt;code&gt;Function.prototype&lt;/code&gt;. &lt;/p&gt;
&lt;p&gt;Apply takes two parameters: the first parameter is an object to bind the &lt;code&gt;this&lt;/code&gt; parameter to, the second is an array which is mapped to the parameters:&lt;/p&gt;
&lt;table class="highlighttable"&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class="linenos"&gt;&lt;div class="linenodiv"&gt;&lt;pre&gt;1
2
3
4
5
6&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;td class="code"&gt;&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="kd"&gt;var&lt;/span&gt; &lt;span class="nx"&gt;add&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="kd"&gt;function&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;num1&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="nx"&gt;num2&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
        &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="nx"&gt;num1&lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="nx"&gt;num2&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;span class="p"&gt;}&lt;/span&gt;

&lt;span class="nx"&gt;array&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="cp"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;3&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="mi"&gt;4&lt;/span&gt;&lt;span class="cp"&gt;]&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;span class="nx"&gt;add&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;apply&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="kc"&gt;null&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="nx"&gt;array&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt; &lt;span class="c1"&gt;//7&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;

&lt;p&gt;In the example above, &lt;code&gt;this&lt;/code&gt; is bound to null (the function is not an object, so it is not needed) and array is bound to &lt;code&gt;num1&lt;/code&gt; and &lt;code&gt;num2&lt;/code&gt;. More interesting things can be done with the first parameter:&lt;/p&gt;
&lt;table class="highlighttable"&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class="linenos"&gt;&lt;div class="linenodiv"&gt;&lt;pre&gt; 1
 2
 3
 4
 5
 6
 7
 8
 9
10&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;td class="code"&gt;&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="kd"&gt;var&lt;/span&gt; &lt;span class="nx"&gt;obj&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
    &lt;span class="nx"&gt;data&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="s1"&gt;'Hello World'&lt;/span&gt;
&lt;span class="p"&gt;}&lt;/span&gt;

&lt;span class="kd"&gt;var&lt;/span&gt; &lt;span class="nx"&gt;displayData&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="kd"&gt;function&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
    &lt;span class="nx"&gt;alert&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="k"&gt;this&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;data&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
&lt;span class="p"&gt;}&lt;/span&gt;

&lt;span class="nx"&gt;displayData&lt;/span&gt;&lt;span class="p"&gt;();&lt;/span&gt; &lt;span class="c1"&gt;//undefined&lt;/span&gt;
&lt;span class="nx"&gt;displayData&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;apply&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;obj&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt; &lt;span class="c1"&gt;//Hello World&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;

&lt;p&gt;The example above uses &lt;code&gt;apply&lt;/code&gt; to bind &lt;code&gt;this&lt;/code&gt; to &lt;code&gt;obj&lt;/code&gt;. This results in being able to produce a value for &lt;code&gt;this.data&lt;/code&gt;. Being able to expicitly assign a value to &lt;code&gt;this&lt;/code&gt; is where the real value of apply comes about. Without this feature, we might as well use &lt;code&gt;()&lt;/code&gt; to invoke functions.&lt;/p&gt;
&lt;p&gt;JavaScript also has another invoker called &lt;code&gt;call&lt;/code&gt;, that is identical to &lt;code&gt;apply&lt;/code&gt; except that instead of taking an array of parameters, it takes an argument list. If JavaScript would implement function overriding, I think that &lt;code&gt;call&lt;/code&gt; would be an overridden variant of &lt;code&gt;apply&lt;/code&gt;. Therefore one talks about &lt;code&gt;apply&lt;/code&gt; and &lt;code&gt;call&lt;/code&gt; in the same vein.&lt;/p&gt;
&lt;h1 id="conclusion"&gt;Conclusion&lt;a href="#conclusion" title="Permanent link" class="headerlink"&gt;&lt;/a&gt;&lt;/h1&gt;
&lt;p&gt;For better or worse, JavaScript is about to take over the world. It is therefore very important that the peculiarities of the language be known and avoided. Learning how the four function invocation methods differ and how to avoid their pitfalls is fundamental to anyone who wants to use JavaScript. I hope this post has helped people when it comes to invoking functions.&lt;/p&gt;
&lt;h2 id="update"&gt;Update&lt;a href="#update" title="Permanent link" class="headerlink"&gt;&lt;/a&gt;&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;Wow, this has &lt;a href="http://doctrina.org/static/images/TopOfHackerNews.png"&gt;reached top of Hacker News&lt;/a&gt;&lt;sup class="print"&gt;L8&lt;/sup&gt;. Thanks for upvoting it everybody.&lt;/li&gt;
&lt;li&gt;Now its also gonna be &lt;a href="http://hackermonthly.com/issue-32.html"&gt;published&lt;/a&gt;&lt;sup class="print"&gt;L9&lt;/sup&gt; :)&lt;/li&gt;
&lt;/ul&gt;&lt;h2 class="print"&gt;Links&lt;/h2&gt;&lt;div style="margin-left: 2.0em;" class="print"&gt;&lt;ol class="print-links"&gt;&lt;li&gt;http://doctrina.org/JavaScript:Why-Understanding-Scope-And-Closures-Matter.html&lt;/li&gt;&lt;li&gt;http://doctrina.org/JavaScript:Why-Understanding-Scope-And-Closures-Matter.html#closures&lt;/li&gt;&lt;li&gt;http://doctrina.org/Javascript-Objects-Prototypes.html#cofl&lt;/li&gt;&lt;li&gt;http://doctrina.org/Javascript-Objects-Prototypes.html&lt;/li&gt;&lt;li&gt;http://doctrina.org/Javascript-Objects-Prototypes.html#pcip&lt;/li&gt;&lt;li&gt;http://doctrina.org/Javascript-Objects-Prototypes.html#remedy&lt;/li&gt;&lt;li&gt;http://doctrina.org/Javascript-Objects-Prototypes.html#cfo&lt;/li&gt;&lt;li&gt;http://doctrina.org/static/images/TopOfHackerNews.png&lt;/li&gt;&lt;li&gt;http://hackermonthly.com/issue-32.html&lt;/li&gt;&lt;/ol&gt;&lt;/div&gt;</summary><category term="development"></category><category term="JavaScript"></category></entry><entry><title>Javascript: Object Prototypes</title><link href="http://doctrina.org/Javascript-Objects-Prototypes.html" rel="alternate"></link><updated>2012-10-12T00:00:00-07:00</updated><author><name>Barry Steyn</name></author><id>tag:doctrina.org,2012-10-12:Javascript-Objects-Prototypes.html</id><summary type="html">&lt;p&gt;This post discusses JavaScript objects with emphasis on its prototype linkings. After reading this post, you should understand the following:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Object creation in JavaScript.&lt;/li&gt;
&lt;li&gt;Prototype linkings.&lt;/li&gt;
&lt;li&gt;What &lt;code&gt;Object.prototype&lt;/code&gt; and &lt;code&gt;Function.prototype&lt;/code&gt; are used for.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;a href="http://en.wikipedia.org/wiki/Douglas_Crockford"&gt;Douglas Crockford's&lt;/a&gt;&lt;sup class="print"&gt;L1&lt;/sup&gt; wonderful book &lt;a href="http://www.amazon.com/JavaScript-Good-Parts-Douglas-Crockford/dp/0596517742/ref=sr_1_1?ie=UTF8&amp;amp;qid=1346978272&amp;amp;sr=8-1&amp;amp;keywords=javascript+the+good+parts"&gt;JavaScript: The Good Parts&lt;/a&gt;&lt;sup class="print"&gt;L2&lt;/sup&gt; does a fanastic job of explaining this topic, and I urge the interested reader to buy his book.&lt;/p&gt;
&lt;h1 id="javascript-objects"&gt;JavaScript Objects&lt;a href="#javascript-objects" title="Permanent link" class="headerlink"&gt;&lt;/a&gt;&lt;/h1&gt;
&lt;p&gt;In JavaScript the simple types are &lt;em&gt;numbers&lt;/em&gt;, &lt;em&gt;strings&lt;/em&gt;, &lt;em&gt;booleans&lt;/em&gt; (&lt;em&gt;true&lt;/em&gt; and &lt;em&gt;false&lt;/em&gt;), &lt;em&gt;null&lt;/em&gt; and &lt;em&gt;undefined&lt;/em&gt;. All other values are objects. Even though there are multiple ways to create objects, there are really only two &lt;em&gt;atomic&lt;/em&gt; mechanisms that are used:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;Literals. &lt;/li&gt;
&lt;li&gt;Functions.&lt;/li&gt;
&lt;/ol&gt;
&lt;h2 id="creating-objects-from-literals"&gt;Creating Objects From Literals &lt;a id="cofl"&gt;&lt;/a&gt;&lt;a href="#creating-objects-from-literals" title="Permanent link" class="headerlink"&gt;&lt;/a&gt;&lt;/h2&gt;
&lt;p&gt;Creating objects from literals is very simple. The following is an &lt;em&gt;object literal&lt;/em&gt;:&lt;/p&gt;
&lt;table class="highlighttable"&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class="linenos"&gt;&lt;div class="linenodiv"&gt;&lt;pre&gt;1
2
3
4
5&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;td class="code"&gt;&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="kd"&gt;var&lt;/span&gt; &lt;span class="nx"&gt;person&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;  
    &lt;span class="s2"&gt;"First_Name"&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;"Barry"&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;  
    &lt;span class="s2"&gt;"Last_Name"&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;"Steyn"&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
    &lt;span class="s2"&gt;"do_Something"&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="kd"&gt;function&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt; &lt;span class="nx"&gt;alert&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;'something'&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt; &lt;span class="p"&gt;}&lt;/span&gt;
&lt;span class="p"&gt;}&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;

&lt;p&gt;Object Literals do not look like traditional objects. In fact, Object Literals look more like a structure that can hold things.  There is however one difference between a JavaScript object and a structure that can hold things: All JavaScript objects have a &lt;em&gt;prototype&lt;/em&gt; linking.&lt;/p&gt;
&lt;h2 id="the-prototype-link"&gt;The Prototype Link&lt;a href="#the-prototype-link" title="Permanent link" class="headerlink"&gt;&lt;/a&gt;&lt;/h2&gt;
&lt;p&gt;Every Object has a &lt;em&gt;hidden&lt;/em&gt; link to another object called a &lt;em&gt;prototype link&lt;/em&gt;. Objects by default are linked to the object &lt;code&gt;Object.prototype&lt;/code&gt;. The prototype link is only used when retrieving property values from an object (it is not touched when updating an object). When retrieving a property value from an object, if it cannot be found, it will look for it in the prototype object that it is linked to. For example:&lt;/p&gt;
&lt;table class="highlighttable"&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class="linenos"&gt;&lt;div class="linenodiv"&gt;&lt;pre&gt;1&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;td class="code"&gt;&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="n"&gt;person&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;age&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt; &lt;span class="c1"&gt;// undefined - property age does not exist&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;

&lt;p&gt;JavaScript tried to find the property age on person, and it could not. So then it tried to find it on &lt;code&gt;Object.prototype&lt;/code&gt; and it could not find it either. So it returned "&lt;em&gt;undefined&lt;/em&gt;".&lt;/p&gt;
&lt;table class="highlighttable"&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class="linenos"&gt;&lt;div class="linenodiv"&gt;&lt;pre&gt;1
2&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;td class="code"&gt;&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="n"&gt;Object&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;prototype&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;age&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="mi"&gt;56&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt; &lt;span class="c1"&gt;// Every object is linked to Object.prototype by default&lt;/span&gt;
&lt;span class="n"&gt;person&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;age&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt; &lt;span class="c1"&gt;// 56&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;

&lt;p&gt;JavaScript could not find age on person, but it did find it on &lt;code&gt;Object.prototype&lt;/code&gt;, which is linked to person. Therefore the prototype linkage is used to &lt;em&gt;augment&lt;/em&gt; an object with additional properties. In a classical object oriented language like Java or C++, augmentation is performed using inheritance. And so a prototype link can be considered as providing the property augmentation feature of object inheritance.&lt;/p&gt;
&lt;h2 id="creating-function-objects"&gt;Creating Function Objects &lt;a id="cfo"&gt;&lt;/a&gt;&lt;a href="#creating-function-objects" title="Permanent link" class="headerlink"&gt;&lt;/a&gt;&lt;/h2&gt;
&lt;p&gt;Functions in JavaScript are objects and are &lt;a href="http://en.wikipedia.org/wiki/First-class_citizen"&gt;first class citizens&lt;/a&gt;&lt;sup class="print"&gt;L3&lt;/sup&gt;. A variable can be assigned a function object like so:&lt;/p&gt;
&lt;table class="highlighttable"&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class="linenos"&gt;&lt;div class="linenodiv"&gt;&lt;pre&gt;1
2
3
4
5&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;td class="code"&gt;&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="kd"&gt;var&lt;/span&gt; &lt;span class="nx"&gt;addNum&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="kd"&gt;function&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;num1&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="nx"&gt;num2&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
        &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="nx"&gt;num1&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="nx"&gt;num2&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;span class="p"&gt;}&lt;/span&gt;

&lt;span class="k"&gt;typeof&lt;/span&gt; &lt;span class="nx"&gt;addNum&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt; &lt;span class="c1"&gt;//function - which is an object in JavaScript&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;

&lt;p&gt;Since functions are objects, they too have a prototype link. But where object literals are by default linked to &lt;code&gt;Object.prototype&lt;/code&gt;, function objects are linked to &lt;code&gt;Function.prototype&lt;/code&gt;. There is one other difference that function objects have (and this is where it starts get confusing); function objects have in addition to a prototype link a &lt;em&gt;property&lt;/em&gt; called &lt;em&gt;prototype&lt;/em&gt;. This property (again, the &lt;em&gt;prototype&lt;/em&gt; property &lt;strong&gt;is not&lt;/strong&gt; the prototype link) can be manipulated (its use will be explained in the next section).&lt;/p&gt;
&lt;p&gt;Just like &lt;code&gt;Object.prototype&lt;/code&gt; is used to augment objects with properties, so &lt;code&gt;Function.prototype&lt;/code&gt; is used to augment functions with properties.&lt;/p&gt;
&lt;table class="highlighttable"&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class="linenos"&gt;&lt;div class="linenodiv"&gt;&lt;pre&gt;1
2
3
4
5
6
7
8
9&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;td class="code"&gt;&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="kd"&gt;var&lt;/span&gt; &lt;span class="nx"&gt;result&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nx"&gt;addNum&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;3&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="mi"&gt;4&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt; &lt;span class="c1"&gt;// 7&lt;/span&gt;

&lt;span class="c1"&gt;//Add a function to Function.prototype&lt;/span&gt;
&lt;span class="nb"&gt;Function&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;prototype&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;substract&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="kd"&gt;function&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;num1&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="nx"&gt;num2&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
        &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="nx"&gt;num1&lt;/span&gt; &lt;span class="o"&gt;-&lt;/span&gt; &lt;span class="nx"&gt;num2&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;span class="p"&gt;}&lt;/span&gt;

&lt;span class="c1"&gt;//We can now use subtract on any function object&lt;/span&gt;
&lt;span class="nx"&gt;result&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nx"&gt;addNum&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;subtract&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;5&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt; &lt;span class="c1"&gt;//3&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;

&lt;p&gt;&lt;code&gt;Function.prototype&lt;/code&gt; is itself an object (big surprise there), and therefore it is linked to &lt;code&gt;Object.prototype&lt;/code&gt;. If something cannot be found in &lt;code&gt;Function.prototype&lt;/code&gt;, it will be searched for on &lt;code&gt;Function.prototype&lt;/code&gt;'s linked prototype object, which is &lt;code&gt;Object.prototype&lt;/code&gt;.&lt;/p&gt;
&lt;table class="highlighttable"&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class="linenos"&gt;&lt;div class="linenodiv"&gt;&lt;pre&gt;1
2
3
4
5
6&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;td class="code"&gt;&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="nb"&gt;Object&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;prototype&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;denominator&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="mi"&gt;10&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;span class="nb"&gt;Object&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;prototype&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;divide&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="kd"&gt;function&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;num1&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
        &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="nx"&gt;num1&lt;/span&gt; &lt;span class="o"&gt;/&lt;/span&gt; &lt;span class="nx"&gt;denominator&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;span class="p"&gt;}&lt;/span&gt;

&lt;span class="kd"&gt;var&lt;/span&gt; &lt;span class="nx"&gt;result&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nx"&gt;addNum&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;divide&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;50&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt; &lt;span class="c1"&gt;// 5&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;

&lt;p&gt;In the above example, &lt;em&gt;addNum&lt;/em&gt; was searched for &lt;em&gt;divide&lt;/em&gt;. Then &lt;code&gt;Function.prototype&lt;/code&gt; was searched, after which, &lt;code&gt;Object.prototype&lt;/code&gt; was searched, where it was eventually found. Therefore prototype links are chained together, whereby if a property is not found in the current object, it then searches for it in its linked prototype object. And if that object does not have the property, it is then searched for in that object's linked prototype object, and so on, until the process ends with &lt;code&gt;Object.prototype&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;The process described above is the mainstay of &lt;a href="http://en.wikipedia.org/wiki/Prototype-based_programming"&gt;Prototype Based Programming&lt;/a&gt;&lt;sup class="print"&gt;L4&lt;/sup&gt;, and it is called &lt;em&gt;prototype chaining&lt;/em&gt;.&lt;/p&gt;
&lt;h2 id="creating-objects-from-functions"&gt;Creating Objects From Functions &lt;a id="coff"&gt;&lt;/a&gt;&lt;a href="#creating-objects-from-functions" title="Permanent link" class="headerlink"&gt;&lt;/a&gt;&lt;/h2&gt;
&lt;p&gt;This section should not be confused with the previous section. Their titles share similar wording, but in this section, we are going to talk about how to create a new object using a function, and last section we talked about creating function objects.&lt;/p&gt;
&lt;p&gt;To recap from the last section, this is how a &lt;em&gt;function object&lt;/em&gt; is created:&lt;/p&gt;
&lt;table class="highlighttable"&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class="linenos"&gt;&lt;div class="linenodiv"&gt;&lt;pre&gt;1
2
3&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;td class="code"&gt;&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="kd"&gt;var&lt;/span&gt; &lt;span class="nx"&gt;Animal&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="kd"&gt;function&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;name&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
        &lt;span class="k"&gt;this&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;name&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nx"&gt;name&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;span class="p"&gt;}&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;

&lt;p&gt;The variable &lt;code&gt;Animal&lt;/code&gt;:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Is a function and an object (remember, everything is an object in JavaScript).  &lt;/li&gt;
&lt;li&gt;It has a &lt;em&gt;prototype property&lt;/em&gt;, and its prototype link is to set to &lt;code&gt;Function.prototype&lt;/code&gt; by default.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;But something special happens here if the function is invoked with the reserved word &lt;code&gt;new&lt;/code&gt; (called the &lt;a href="http://doctrina.org/Javascript-Function-Invocation-Patterns.html#ci"&gt;constructor invocation pattern&lt;/a&gt;&lt;sup class="print"&gt;L5&lt;/sup&gt;):&lt;/p&gt;
&lt;table class="highlighttable"&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class="linenos"&gt;&lt;div class="linenodiv"&gt;&lt;pre&gt;1&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;td class="code"&gt;&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="kd"&gt;var&lt;/span&gt; &lt;span class="nx"&gt;cat&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="k"&gt;new&lt;/span&gt; &lt;span class="nx"&gt;Animal&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;'fluffy'&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt; &lt;span class="c1"&gt;//Using new to invoke the function&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;

&lt;p&gt;What happens here is that &lt;code&gt;new&lt;/code&gt; creates an object from the function object &lt;code&gt;Animal&lt;/code&gt;. Its power comes in because it will use &lt;code&gt;Animal&lt;/code&gt;'s &lt;em&gt;prototype property&lt;/em&gt; as the &lt;em&gt;prototype link&lt;/em&gt; for the new object. And since &lt;code&gt;Animal&lt;/code&gt; can set the value of its prototype property, objects constructed in this way do not have to be linked to &lt;code&gt;Object.prototype&lt;/code&gt;. Got that? If not, here is an example which should explain things:&lt;/p&gt;
&lt;table class="highlighttable"&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class="linenos"&gt;&lt;div class="linenodiv"&gt;&lt;pre&gt; 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;td class="code"&gt;&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="kd"&gt;var&lt;/span&gt; &lt;span class="nx"&gt;species&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
        &lt;span class="s2"&gt;"species"&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="s2"&gt;"human"&lt;/span&gt;
&lt;span class="p"&gt;}&lt;/span&gt;

&lt;span class="kd"&gt;var&lt;/span&gt; &lt;span class="nx"&gt;Entity&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="kd"&gt;function&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;name&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
    &lt;span class="k"&gt;this&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;name&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nx"&gt;name&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;span class="p"&gt;}&lt;/span&gt;

&lt;span class="kd"&gt;var&lt;/span&gt; &lt;span class="nx"&gt;alien&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="k"&gt;new&lt;/span&gt; &lt;span class="nx"&gt;Entity&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;"Yoda"&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;

&lt;span class="nx"&gt;Entity&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;prototype&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nx"&gt;species&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;span class="kd"&gt;var&lt;/span&gt; &lt;span class="nx"&gt;human&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="k"&gt;new&lt;/span&gt; &lt;span class="nx"&gt;Entity&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;"Jason"&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;

&lt;p&gt;In the above, the &lt;code&gt;alien&lt;/code&gt; and &lt;code&gt;human&lt;/code&gt; objects are constructed from the function &lt;code&gt;Entity&lt;/code&gt; via the &lt;em&gt;constructor invocation pattern&lt;/em&gt; that is initiated by putting the &lt;code&gt;new&lt;/code&gt; keyword in front of the function name. When &lt;code&gt;alien&lt;/code&gt; is constructed, &lt;code&gt;Entity&lt;/code&gt;'s prototype property has not been altered, and so &lt;code&gt;alien&lt;/code&gt; is linked to &lt;code&gt;Object.prototype&lt;/code&gt;. But when constructing &lt;code&gt;human&lt;/code&gt;, &lt;code&gt;Entity&lt;/code&gt;'s prototype property was altered to species, and so the prototype object linked to &lt;code&gt;human&lt;/code&gt; is &lt;code&gt;species&lt;/code&gt;, which in turn is itself linked to &lt;code&gt;Object.prototype&lt;/code&gt;:&lt;/p&gt;
&lt;table class="highlighttable"&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class="linenos"&gt;&lt;div class="linenodiv"&gt;&lt;pre&gt;1
2&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;td class="code"&gt;&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="n"&gt;alien&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;species&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt; &lt;span class="c1"&gt;// undefined&lt;/span&gt;
&lt;span class="n"&gt;human&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;species&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt; &lt;span class="c1"&gt;// human&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;

&lt;h3 id="the-problem-with-using-the-constructor-invocation-pattern"&gt;The problem with using the "constructor invocation pattern" &lt;a id="pcip"&gt;&lt;/a&gt;&lt;a href="#the-problem-with-using-the-constructor-invocation-pattern" title="Permanent link" class="headerlink"&gt;&lt;/a&gt;&lt;/h3&gt;
&lt;p&gt;Using &lt;code&gt;new&lt;/code&gt; is one of four ways in which to invoke a function, the most popular way being to call the function. For example:&lt;/p&gt;
&lt;table class="highlighttable"&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class="linenos"&gt;&lt;div class="linenodiv"&gt;&lt;pre&gt;1
2
3
4
5
6
7&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;td class="code"&gt;&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="kd"&gt;var&lt;/span&gt; &lt;span class="nx"&gt;Vehicle&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="kd"&gt;function&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;type&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
        &lt;span class="k"&gt;this&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;type&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nx"&gt;type&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
        &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="nx"&gt;type&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;span class="p"&gt;}&lt;/span&gt;

&lt;span class="kd"&gt;var&lt;/span&gt; &lt;span class="nx"&gt;car&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nx"&gt;Vehicle&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;"Toyota"&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt; &lt;span class="c1"&gt;// Normal function call&lt;/span&gt;
&lt;span class="kd"&gt;var&lt;/span&gt; &lt;span class="nx"&gt;plane&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="k"&gt;new&lt;/span&gt; &lt;span class="nx"&gt;Vehicle&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;"Boeing"&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;

&lt;p&gt;In the example above, &lt;code&gt;car&lt;/code&gt; was assigned the result of invoking &lt;code&gt;Vehicle&lt;/code&gt; as a normal function, which in this case was &lt;em&gt;Toyota&lt;/em&gt;. But &lt;code&gt;plane&lt;/code&gt; on the other was assigned the result of using the &lt;em&gt;constructor invocation pattern&lt;/em&gt; which is an object (the return is ignored). This is terrible, and it is very easy to make a mistake.&lt;/p&gt;
&lt;p&gt;One recommended approach is to always start functions that are to be invoked with &lt;code&gt;new&lt;/code&gt; with &lt;em&gt;capital letters&lt;/em&gt;. This should help for readability, but when someone is spending days trying to hunt for a bug, this will be little compensation. &lt;a id="remedy"&gt;&lt;/a&gt;Instead, a much better way would be to augment &lt;code&gt;Object&lt;/code&gt; with a create method if it does not exist:&lt;/p&gt;
&lt;table class="highlighttable"&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class="linenos"&gt;&lt;div class="linenodiv"&gt;&lt;pre&gt;1
2
3
4
5
6
7&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;td class="code"&gt;&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="k"&gt;typeof&lt;/span&gt; &lt;span class="nb"&gt;Object&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;create&lt;/span&gt; &lt;span class="o"&gt;!==&lt;/span&gt; &lt;span class="s1"&gt;'function'&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt; &lt;span class="c1"&gt;//If working with a version of JavaScript prior to 1.8.5&lt;/span&gt;
    &lt;span class="nb"&gt;Object&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;create&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="kd"&gt;function&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;o&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
        &lt;span class="kd"&gt;var&lt;/span&gt; &lt;span class="nx"&gt;F&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="kd"&gt;function&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt; &lt;span class="p"&gt;{};&lt;/span&gt;
        &lt;span class="nx"&gt;F&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;prototype&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nx"&gt;o&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
        &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="k"&gt;new&lt;/span&gt; &lt;span class="nx"&gt;F&lt;/span&gt;&lt;span class="p"&gt;();&lt;/span&gt;
    &lt;span class="p"&gt;}&lt;/span&gt;
&lt;span class="p"&gt;}&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;

&lt;p&gt;Objects can now be created with a chosen prototype link by doing the following:&lt;/p&gt;
&lt;table class="highlighttable"&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class="linenos"&gt;&lt;div class="linenodiv"&gt;&lt;pre&gt; 1
 2
 3
 4
 5
 6
 7
 8
 9
10&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;td class="code"&gt;&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="kd"&gt;var&lt;/span&gt; &lt;span class="nx"&gt;animal&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
    &lt;span class="s2"&gt;"type"&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="s2"&gt;"cat"&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
    &lt;span class="s2"&gt;"make_sound"&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="kd"&gt;function&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
        &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="s2"&gt;"purrrr"&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
    &lt;span class="p"&gt;}&lt;/span&gt;
&lt;span class="p"&gt;}&lt;/span&gt;

&lt;span class="kd"&gt;var&lt;/span&gt; &lt;span class="nx"&gt;cat&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nb"&gt;Object&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;create&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;animal&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
&lt;span class="nx"&gt;cat&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;make_sound&lt;/span&gt;&lt;span class="p"&gt;();&lt;/span&gt; &lt;span class="c1"&gt;//purrrr&lt;/span&gt;
&lt;span class="nx"&gt;cat&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;type&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt; &lt;span class="c1"&gt;//cat&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;

&lt;h1 id="conclusion"&gt;Conclusion&lt;a href="#conclusion" title="Permanent link" class="headerlink"&gt;&lt;/a&gt;&lt;/h1&gt;
&lt;p&gt;Object orientation in JavaScript is a bit of a mess. This is because JavaScript is quite unsure about what it is, and ends up being a mix of a classical object oriented language and a prototype based language. Hence we get the &lt;code&gt;new&lt;/code&gt; keyword, which makes JavaScript look like a classical object oriented language, even though it is not.&lt;/p&gt;
&lt;p&gt;To summarise, here are the three objects this blog discusses:&lt;/p&gt;
&lt;table class="highlighttable"&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class="linenos"&gt;&lt;div class="linenodiv"&gt;&lt;pre&gt; 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;td class="code"&gt;&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="c1"&gt;//Object Literal&lt;/span&gt;
&lt;span class="k"&gt;var&lt;/span&gt; &lt;span class="n"&gt;objectLiteral&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
        &lt;span class="s"&gt;"property1"&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="s"&gt;"value1"&lt;/span&gt;
&lt;span class="p"&gt;};&lt;/span&gt;

&lt;span class="c1"&gt;//Function Object&lt;/span&gt;
&lt;span class="k"&gt;var&lt;/span&gt; &lt;span class="n"&gt;functionObject&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="k"&gt;function&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
&lt;span class="p"&gt;}&lt;/span&gt;

&lt;span class="c1"&gt;//Object From Function&lt;/span&gt;
&lt;span class="k"&gt;var&lt;/span&gt; &lt;span class="n"&gt;objectFromFunction&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="k"&gt;new&lt;/span&gt; &lt;span class="n"&gt;functionObject&lt;/span&gt;&lt;span class="p"&gt;();&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;

&lt;p&gt;And to summarise, the prototype linkings and properties available to each object:
&lt;/p&gt;&lt;center&gt;
    &lt;table style="border-style: solid; border-width:1px; border-color: #000000;"&gt;
        &lt;tbody&gt;&lt;tr&gt;
            &lt;td&gt;&lt;b&gt;Object Literal&lt;/b&gt;&lt;/td&gt;
            &lt;td&gt;&lt;b&gt;Function Object&lt;/b&gt;&lt;/td&gt;
            &lt;td&gt;&lt;b&gt;Object From Function&lt;/b&gt;&lt;/td&gt;
        &lt;/tr&gt;
        &lt;tr&gt;
            &lt;td&gt;
                &lt;ul&gt;
                    &lt;li&gt; &lt;em&gt;Construction&lt;/em&gt; - via curly braces &lt;code&gt;{}&lt;/code&gt;&lt;/li&gt;
                    &lt;li&gt; &lt;em&gt;Prototype Link&lt;/em&gt; - Object.prototype&lt;/li&gt;
                    &lt;li&gt; &lt;em&gt;Prototype Property&lt;/em&gt; - does not exist&lt;/li&gt;
                &lt;/ul&gt;
            &lt;/td&gt;
            &lt;td&gt;
                &lt;ul&gt;
                    &lt;li&gt; &lt;em&gt;Construction&lt;/em&gt; - via the &lt;code&gt;function&lt;/code&gt; keyword &lt;/li&gt;
                    &lt;li&gt; &lt;em&gt;Prototype Link&lt;/em&gt; - Function.prototype&lt;/li&gt;
                    &lt;li&gt; &lt;em&gt;Prototype Property&lt;/em&gt; - exists&lt;/li&gt;
                &lt;/ul&gt;
            &lt;/td&gt;
            &lt;td&gt;
                &lt;ul&gt;
                    &lt;li&gt; &lt;em&gt;Construction&lt;/em&gt; - via &lt;code&gt;new&lt;/code&gt; keyword with function object&lt;/li&gt;
                    &lt;li&gt; &lt;em&gt;Prototype Link&lt;/em&gt; - Whatever the function's (that was invoked by &lt;code&gt;new&lt;/code&gt;) prototype property is set to (&lt;code&gt;Object.prototype&lt;/code&gt; by default)&lt;/li&gt;
                    &lt;li&gt; &lt;em&gt;Prototype Property&lt;/em&gt; - does not exist&lt;/li&gt;
                &lt;/ul&gt;
            &lt;/td&gt;
        &lt;/tr&gt;
    &lt;/tbody&gt;&lt;/table&gt;
&lt;/center&gt;&lt;p&gt;&lt;/p&gt;&lt;h2 class="print"&gt;Links&lt;/h2&gt;&lt;div style="margin-left: 2.0em;" class="print"&gt;&lt;ol class="print-links"&gt;&lt;li&gt;http://en.wikipedia.org/wiki/Douglas_Crockford&lt;/li&gt;&lt;li&gt;http://www.amazon.com/JavaScript-Good-Parts-Douglas-Crockford/dp/0596517742/ref=sr_1_1?ie=UTF8&amp;amp;qid=1346978272&amp;amp;sr=8-1&amp;amp;keywords=javascript+the+good+parts&lt;/li&gt;&lt;li&gt;http://en.wikipedia.org/wiki/First-class_citizen&lt;/li&gt;&lt;li&gt;http://en.wikipedia.org/wiki/Prototype-based_programming&lt;/li&gt;&lt;li&gt;http://doctrina.org/Javascript-Function-Invocation-Patterns.html#ci&lt;/li&gt;&lt;/ol&gt;&lt;/div&gt;</summary><category term="development"></category><category term="JavaScript"></category></entry><entry><title>The 3 Seminal Events In Cryptography</title><link href="http://doctrina.org/The-3-Seminal-Events-In-Cryptography.html" rel="alternate"></link><updated>2012-05-20T00:00:00-07:00</updated><author><name>Barry Steyn</name></author><id>tag:doctrina.org,2012-05-20:The-3-Seminal-Events-In-Cryptography.html</id><summary type="html">&lt;p&gt;Cryptography is the art/science of keeping a secret. This need has been present since prerecorded human history, but we have some very famous early examples such as the &lt;a href="http://en.wikipedia.org/wiki/Caesar_cipher"&gt;Caesar Cipher&lt;/a&gt;&lt;sup class="print"&gt;L1&lt;/sup&gt;. Yet these early examples were very easy to break. It took until the twentieth century for cryptography to be rigorously defined and useful to a wider audience, and it was largely done so in three seminal papers:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;em&gt;Communication Theory of Secret Systems&lt;/em&gt; by &lt;a href="http://en.wikipedia.org/wiki/Claude_Shannon"&gt;Claude Shannon&lt;/a&gt;&lt;sup class="print"&gt;L2&lt;/sup&gt;&lt;/li&gt;
&lt;li&gt;&lt;em&gt;New Directions In Cryptography&lt;/em&gt; by &lt;a href="http://en.wikipedia.org/wiki/Whitfield_Diffie"&gt;Whitfield Diffie&lt;/a&gt;&lt;sup class="print"&gt;L3&lt;/sup&gt; and &lt;a href="http://en.wikipedia.org/wiki/Martin_Hellman"&gt;Martin Hellman&lt;/a&gt;&lt;sup class="print"&gt;L4&lt;/sup&gt;&lt;/li&gt;
&lt;li&gt;&lt;em&gt;A Method for Obtaining Digital Signatures and Public-Key Cryptosystems&lt;/em&gt; by &lt;a href="http://en.wikipedia.org/wiki/Ron_Rivest"&gt;Ronald Rivest&lt;/a&gt;&lt;sup class="print"&gt;L5&lt;/sup&gt;, &lt;a href="http://en.wikipedia.org/wiki/Adi_Shamir"&gt;Adi Shamir&lt;/a&gt;&lt;sup class="print"&gt;L6&lt;/sup&gt; and &lt;a href="http://en.wikipedia.org/wiki/Leonard_Adleman"&gt;Leanard Adleman&lt;/a&gt;&lt;sup class="print"&gt;L7&lt;/sup&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;For this explanation, it helps to give a quick definition of the cryptographic process. A message (called the plain text) must be encrypted to cipher text. It is done so via an algorithm that takes two inputs - the &lt;em&gt;plain text&lt;/em&gt; to be encrypted, and a &lt;em&gt;secret key&lt;/em&gt;.&lt;/p&gt;
&lt;h1 id="communication-theory-of-secret-systems-by-claude-shannon"&gt;Communication Theory of Secret Systems by Claude Shannon&lt;a href="#communication-theory-of-secret-systems-by-claude-shannon" title="Permanent link" class="headerlink"&gt;&lt;/a&gt;&lt;/h1&gt;
&lt;p&gt;How does one define security of a cipher? This question had not been rigorously answered until the above paper in 1949 by Claude Shannon was published. Claude Shannon has often been called the father of the digital world. One of the founding fathers of this amazing age that we live in, there is hardly anything that we take for granted in the electronic age that Claude Shannon did not have a hand in designing.&lt;/p&gt;
&lt;p&gt;Thank goodness Shannon had some spare time to devote to cryptography. His paper defines a secure cipher as &lt;em&gt;not letting anyone learn anything about the plain text given just the cipher text&lt;/em&gt;. He thus defines a perfect cipher as the following: Given a cipher text, the probability that it resulted from any plain text is equal. Okay, that does not sound so special, but that is because I dumbed it down a bit. It actually means that when you are given some cipher text, you have absolutely no idea what plain text was used as input to produce the cipher text, seeing as all plain text have the same probability to produce the cipher text, it could have been any plain text - we just don't know!&lt;/p&gt;
&lt;p&gt;Unfortunately, Shannon also proved that in order to have this perfect security, one needs a key at least as big as the message space. This makes perfect security impracticable: Given a message that it is a few gigabytes of size, the key to producing a perfect cipher must also be a few gigabytes large! So modern cryptography tries to relax the conditions of perfect security by defining something called &lt;em&gt;semantic security&lt;/em&gt;. Semantic security says that no efficient algorithm must have the ability to determine what plaintext produced the cipher text. More importantly, by relaxing Shannon's security definition, we are able to use keys that are tiny in comparison. Because it is not perfect by Shannon's definition, an algorithm can be produced that should be able to break the cipher. But as long as we make it so that the effort required is tantamount to waiting until the end of the universe, we are safe.&lt;/p&gt;
&lt;p&gt;Semantic security defines our modern cryptographic age. To be sure, if a cipher is semantic secure, it can also suffer from &lt;em&gt;chosen plaintext attacks&lt;/em&gt; and &lt;em&gt;chosen ciphertext attacks&lt;/em&gt;, but at least now we have a base metric which we can use to measure how effective our security is. And indeed, modern cryptographic atomics, like AES (advanced encryption standard) is as far as we know, semantically secure. And so we use it all the time.&lt;/p&gt;
&lt;h1 id="new-directions-in-cryptography-by-whitfield-diffie-and-martin-hellman"&gt;New Directions In Cryptography by Whitfield Diffie and Martin Hellman&lt;a href="#new-directions-in-cryptography-by-whitfield-diffie-and-martin-hellman" title="Permanent link" class="headerlink"&gt;&lt;/a&gt;&lt;/h1&gt;
&lt;p&gt;The next big thing that happened has all to due with secret keys. A cipher such as AES is semantically secure, and so using it should be secure for two parties. But how can two parties agree upon a secret key to use with encryption without letting anyone know? In the Internet age, this problem is even more acute than one may suspect: Given two people that are separated by vast geographical distances and connected by the Internet who wish to communicate securely, how do they agree upon a secret key without anyone else being able to discover this secret key. The Internet is a very insecure medium by fact of anyone being able to connect to it. So agreeing upon a secret key in a secure manner over an insecure medium is not a trivial problem.&lt;/p&gt;
&lt;p&gt;Diffie-Hellman to the rescue! Their seminal paper allows us to perform the amazing feat of securely agreeing upon a secret over an insecure medium. I'm going to save it for another post in order to explain how Diffie-Hellman works (it requires some math background), but suffice it to say that Diffie-Hallman makes it possible for secure communication to happen anywhere over any connection.&lt;/p&gt;
&lt;h1 id="a-method-for-obtaining-digital-signatures-and-public-key-cryptosystems-by-ronald-rivest-adi-shamir-and-leanard-adleman"&gt;A Method for Obtaining Digital Signatures and Public-Key Cryptosystems by Ronald Rivest, Adi Shamir and Leanard Adleman&lt;a href="#a-method-for-obtaining-digital-signatures-and-public-key-cryptosystems-by-ronald-rivest-adi-shamir-and-leanard-adleman" title="Permanent link" class="headerlink"&gt;&lt;/a&gt;&lt;/h1&gt;
&lt;p&gt;The last of the seminal papers was a really huge idea. Up until now, people had used the same key to both encrypt and decrypt their messages. One could think about encryption as a door with a lock: The same key used to lock the door is also used to unlock the door. The above paper changed all that!&lt;/p&gt;
&lt;p&gt;Commonly known as RSA (taken from the first letter of the surnames of the three inventors), it ushered in the era of &lt;em&gt;public key encryption&lt;/em&gt;, and allowed cryptography to do more than just keep secrets - it allowed cryptography to also uniquely identify a party thus making digital signatures possible.&lt;/p&gt;
&lt;p&gt;Public key cryptography works by having two keys: A public key, and a private key. The names are very descriptive: A public key is kept public and is shared with the world, a private key is kept private and may not be shared with anyone. If one encrypts with one key, then one must use the other key to decrypt. So if two users wish to communicate securely, then one of the users just asks for the other user's public key. The message is then encrypted using the public key, but the user with the private key is the only entity able to decrypt it. So it is useless to anyone else.&lt;/p&gt;
&lt;p&gt;Just as interesting is if something is encrypted using the private key. Only the public key can be used to decrypt. This may seem counter-intuitive at first, but think about what problem this solves. If I have your public key, and you give me something encrypted using your private key, then I am able to ensure that you are the person - and not anyone masquerading as you - who encrypted the message. This is because you are the only person with the private key. So your public key will only work with things that are encrypted with your private key, something which only you have access to. And this is the essence of a digital signature.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Update&lt;/strong&gt;: I have written two blog posts explaining &lt;a href="http://doctrina.org/How-RSA-Works-With-Examples.html"&gt;how RSA works&lt;/a&gt;&lt;sup class="print"&gt;L8&lt;/sup&gt; and &lt;a href="http://doctrina.org/Why-RSA-Works-Three-Fundamental-Questions-Answered.html"&gt;why RSA works&lt;/a&gt;&lt;sup class="print"&gt;L9&lt;/sup&gt;.&lt;/p&gt;&lt;h2 class="print"&gt;Links&lt;/h2&gt;&lt;div style="margin-left: 2.0em;" class="print"&gt;&lt;ol class="print-links"&gt;&lt;li&gt;http://en.wikipedia.org/wiki/Caesar_cipher&lt;/li&gt;&lt;li&gt;http://en.wikipedia.org/wiki/Claude_Shannon&lt;/li&gt;&lt;li&gt;http://en.wikipedia.org/wiki/Whitfield_Diffie&lt;/li&gt;&lt;li&gt;http://en.wikipedia.org/wiki/Martin_Hellman&lt;/li&gt;&lt;li&gt;http://en.wikipedia.org/wiki/Ron_Rivest&lt;/li&gt;&lt;li&gt;http://en.wikipedia.org/wiki/Adi_Shamir&lt;/li&gt;&lt;li&gt;http://en.wikipedia.org/wiki/Leonard_Adleman&lt;/li&gt;&lt;li&gt;http://doctrina.org/How-RSA-Works-With-Examples.html&lt;/li&gt;&lt;li&gt;http://doctrina.org/Why-RSA-Works-Three-Fundamental-Questions-Answered.html&lt;/li&gt;&lt;/ol&gt;&lt;/div&gt;</summary><category term="cryptography"></category></entry><entry><title>Upstart With NodeJS And NVM</title><link href="http://doctrina.org/NodeJS-Under-NVM-With-Upstart.html" rel="alternate"></link><updated>2012-05-12T00:00:00-07:00</updated><author><name>Barry Steyn</name></author><id>tag:doctrina.org,2012-05-12:NodeJS-Under-NVM-With-Upstart.html</id><summary type="html">&lt;p&gt;Yet another very short blog article to help anyone who wants to setup an upstart process that runs a &lt;a href="http://nodejs.org/"&gt;NodeJS&lt;/a&gt;&lt;sup class="print"&gt;L1&lt;/sup&gt; app under &lt;a href="https://github.com/creationix/nvm"&gt;nvm&lt;/a&gt;&lt;sup class="print"&gt;L2&lt;/sup&gt;. Unlike the &lt;a href="http://doctrina.org/VirtualEnv-With-Upstart.html"&gt;uwsgi setup&lt;/a&gt;&lt;sup class="print"&gt;L3&lt;/sup&gt;, there is no specific argument switch to give Node that will make it use nvm environment variables. In fact, since Node is single threaded, there is no special server process that must run in the background to interact with it (unlike &lt;a href="http://projects.unbit.it/uwsgi/"&gt;uwsgi&lt;/a&gt;&lt;sup class="print"&gt;L4&lt;/sup&gt; that is needed for Python). This means that whatever executes Node must also introduce the environment variables manually. But doesn't that defeat the purpose of &lt;a href="https://github.com/creationix/nvm"&gt;nvm&lt;/a&gt;&lt;sup class="print"&gt;L2&lt;/sup&gt;? Yes, it does! So lets just use &lt;a href="https://github.com/creationix/nvm"&gt;nvm&lt;/a&gt;&lt;sup class="print"&gt;L2&lt;/sup&gt; to &lt;em&gt;manually introduce those environment variables&lt;/em&gt;.&lt;/p&gt;
&lt;p&gt;In order to run a &lt;a href="http://nodejs.org/"&gt;Node&lt;/a&gt;&lt;sup class="print"&gt;L1&lt;/sup&gt; server in upstart that is under nvm, two things need to be determined:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;The folder where the node app is defined. Not only is this the path where node will execute your app, but node will also search a folder called &lt;em&gt;node_modules&lt;/em&gt; under this path for &lt;em&gt;locally installed libraries&lt;/em&gt;&lt;/li&gt;
&lt;li&gt;The folder where you have installed your &lt;code&gt;nvm.sh&lt;/code&gt; script.&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;&lt;strong&gt;NOTE&lt;/strong&gt;: For what follows, the assumption is that the version of node that will be used for execution is the &lt;a href="https://github.com/creationix/nvm#usage"&gt;default version of nvm&lt;/a&gt;&lt;sup class="print"&gt;L5&lt;/sup&gt;. This accomplished by using &lt;code&gt;alias&lt;/code&gt; with nvm to set &lt;code&gt;default&lt;/code&gt; (see previous link).&lt;/p&gt;
&lt;h1 id="an-upstart-example"&gt;An Upstart Example&lt;a href="#an-upstart-example" title="Permanent link" class="headerlink"&gt;&lt;/a&gt;&lt;/h1&gt;
&lt;p&gt;Lets assume the following:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Your app is defined in the path &lt;code&gt;"/home/dev/node-script"&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;The &lt;em&gt;nvm.sh&lt;/em&gt; script is installed in &lt;code&gt;"/home/dev/nvm/nvm.sh"&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Then an upstart script to start node that will run this script under nvm is as follows:
&lt;script src="https://gist.github.com/4467515.js"&gt;&lt;/script&gt;&lt;/p&gt;
&lt;p&gt;The above upstart script is very basic, so you should customize it to suit your needs. Yet it has the essential ingredients. The important bit is the &lt;em&gt;exec&lt;/em&gt; command on line 11, which starts a bash shell script with the argument &lt;code&gt;-c&lt;/code&gt;. This argument means that any text afterwards will be executed as a command script. The command script passed does two things that are separated by &lt;code&gt;&amp;amp;&amp;amp;&lt;/code&gt; (the logical and operator):&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;code&gt;source /home/dev/nvm/nvm.sh&lt;/code&gt; - this will execute the &lt;code&gt;nvm.sh&lt;/code&gt; shell script that loads/creates all relevant environment variables. By using the &lt;a href="http://ss64.com/bash/period.html"&gt;source&lt;/a&gt;&lt;sup class="print"&gt;L6&lt;/sup&gt; command, all these variables are put within the current shell that it is running in.&lt;/li&gt;
&lt;li&gt;&lt;code&gt;exec node app&lt;/code&gt; - it is essential that we use &lt;a href="http://ss64.com/bash/exec.html"&gt;exec&lt;/a&gt;&lt;sup class="print"&gt;L7&lt;/sup&gt; to execute the node app. This will replace the current shell with &lt;code&gt;node app&lt;/code&gt; &lt;em&gt;without creating a new process&lt;/em&gt;.&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;The result of the above two commands is that the node app is executed within its own process but which has access to all environment variables that results from running the nvm shell script.&lt;/p&gt;&lt;h2 class="print"&gt;Links&lt;/h2&gt;&lt;div style="margin-left: 2.0em;" class="print"&gt;&lt;ol class="print-links"&gt;&lt;li&gt;http://nodejs.org/&lt;/li&gt;&lt;li&gt;https://github.com/creationix/nvm&lt;/li&gt;&lt;li&gt;http://doctrina.org/VirtualEnv-With-Upstart.html&lt;/li&gt;&lt;li&gt;http://projects.unbit.it/uwsgi/&lt;/li&gt;&lt;li&gt;https://github.com/creationix/nvm#usage&lt;/li&gt;&lt;li&gt;http://ss64.com/bash/period.html&lt;/li&gt;&lt;li&gt;http://ss64.com/bash/exec.html&lt;/li&gt;&lt;/ol&gt;&lt;/div&gt;</summary><category term="System Administration"></category></entry></feed>